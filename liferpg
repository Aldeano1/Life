<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG Life: Realism v9</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #3b82f6; --accent: #8b5cf6; --gold: #f59e0b; --danger: #ef4444; --text: #f8fafc; --muted: #94a3b8; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 420px; position: relative; padding-bottom: 50px; }
        
        /* LANGUAGE */
        .lang-switch { position: absolute; top: -35px; right: 0; display: flex; gap: 5px; }
        .lang-btn { background: var(--card); border: 1px solid #334155; color: var(--muted); padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; cursor: pointer; }
        .lang-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .screen { display: none; animation: fade 0.4s; }
        .active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h1 { text-align: center; color: var(--primary); margin: 0 0 15px 0; font-size: 24px; }
        label { display: block; color: var(--muted); font-size: 11px; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
        select, input { width: 100%; padding: 12px; background: var(--card); border: 2px solid #334155; color: white; border-radius: 8px; font-size: 15px; margin-bottom: 15px; outline: none; box-sizing: border-box; }
        select:focus, input:focus { border-color: var(--primary); }
        
        .btn-main { background: linear-gradient(135deg, var(--primary), var(--accent)); width: 100%; padding: 14px; border: none; border-radius: 10px; color: white; font-weight: bold; font-size: 16px; margin-top: 10px; cursor: pointer; transition: 0.2s; }
        .btn-main:active { transform: scale(0.98); opacity: 0.9; }

        /* MODE TOGGLE */
        .mode-toggle { display: flex; background: var(--card); border-radius: 10px; padding: 4px; margin-bottom: 20px; border: 1px solid #334155; }
        .mode-btn { flex: 1; border: none; background: none; color: var(--muted); padding: 10px; font-weight: bold; font-size: 13px; cursor: pointer; border-radius: 8px; }
        .mode-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* CUSTOM AREA */
        #custom-area { display: none; background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 10px; border: 1px dashed var(--primary); margin-bottom: 15px; }
        #custom-area.show { display: block; animation: fade 0.3s; }

        /* PROFILE */
        .profile-card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #334155; position: relative; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .clan-tag { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-size: 10px; color: var(--accent); border: 1px solid var(--accent); }
        .char-name { font-size: 22px; font-weight: 800; margin-bottom: 4px; }
        .char-job { color: var(--muted); font-size: 13px; display: block; margin-bottom: 12px; font-style: italic; }
        
        .level-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 6px; font-size: 12px; color: var(--muted); }
        .lvl-big { font-size: 26px; color: var(--gold); font-weight: bold; line-height: 1; }
        .xp-bar-bg { background: #0f172a; height: 10px; border-radius: 5px; overflow: hidden; border: 1px solid #334155; }
        .xp-bar-fill { background: linear-gradient(90deg, var(--gold), #fcd34d); height: 100%; width: 0%; transition: width 0.4s cubic-bezier(0.25, 1, 0.5, 1); }

        /* STATS */
        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .stat-box { background: #0f172a; padding: 12px 5px; border-radius: 10px; text-align: center; border: 1px solid #334155; }
        .s-val { font-size: 22px; font-weight: bold; display: block; line-height: 1.1; }
        .s-lbl { font-size: 9px; color: var(--muted); font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .c-str { color: #ef4444; } .c-cha { color: #f472b6; } .c-int { color: #3b82f6; }

        /* MISSIONS */
        .m-group { margin-bottom: 15px; }
        .m-head { font-size: 10px; color: var(--muted); font-weight: bold; text-transform: uppercase; border-bottom: 1px solid #334155; margin-bottom: 8px; padding-bottom: 4px; letter-spacing: 1px; }
        .m-btn { 
            background: var(--card); border: 1px solid #334155; padding: 14px; border-radius: 12px; 
            margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; 
            color: white; text-align: left; cursor: pointer; transition: 0.1s; position: relative; overflow: hidden;
        }
        .m-btn:active { transform: scale(0.98); background: #334155; border-color: var(--primary); }
        .m-info { flex: 1; margin-right: 10px; }
        .m-title { font-size: 14px; font-weight: 600; display: block; margin-bottom: 2px; }
        .m-desc { font-size: 11px; color: var(--muted); }
        .xp-badge { background: rgba(255,255,255,0.08); padding: 6px 10px; border-radius: 8px; font-size: 12px; color: var(--gold); font-weight: bold; min-width: 50px; text-align: center; }

        /* UTILS */
        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--gold); color: black; padding: 10px 20px; border-radius: 30px; font-weight: bold; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 99; width: 80%; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .settings-link { display: block; text-align: center; color: #475569; font-size: 12px; text-decoration: underline; margin-top: 20px; cursor: pointer; padding: 10px; }
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        .modal { background: var(--card); padding: 25px; border-radius: 15px; width: 100%; max-width: 320px; text-align: center; border: 1px solid var(--danger); }
        #error-msg { display:none; color:white; background:#ef4444; padding:20px; position:fixed; top:0; left:0; width:100%; z-index:9999; text-align:center; }
    </style>
</head>
<body>

<div id="error-msg">Error de datos. <button onclick="localStorage.clear();location.reload()">Reset</button></div>

<div class="container">
    <div class="lang-switch">
        <button class="lang-btn active" id="btn-es" onclick="setLang('es')">ES</button>
        <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
    </div>

    <div id="screen-create" class="screen">
        <h1 data-t="t_create">CREA TU PERFIL</h1>
        
        <div class="mode-toggle">
            <button class="mode-btn active" id="t-work" onclick="setMode('work')">üëî TRABAJO</button>
            <button class="mode-btn" id="t-study" onclick="setMode('study')">üéì ESTUDIO</button>
        </div>

        <label data-t="l_name">Nombre</label>
        <input type="text" id="inp-name" placeholder="...">
        
        <label data-t="l_clan">Clan</label>
        <select id="inp-clan"></select>

        <label id="lbl-cat" data-t="l_cat">Industria / Facultad</label>
        <select id="inp-category" onchange="updateSubSelect()"></select>

        <label id="lbl-job" data-t="l_job">Rol / Carrera</label>
        <select id="inp-job" onchange="checkCustomJob()"></select>

        <div id="custom-area">
            <label style="color:var(--primary)">‚ú® <span data-t="l_custom">Escribe tu Rol Exacto:</span></label>
            <input type="text" id="inp-custom-text" placeholder="...">
        </div>

        <button class="btn-main" onclick="startGame()" data-t="b_start">COMENZAR AVENTURA</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="profile-card">
            <span class="clan-tag" id="ui-clan">Clan</span>
            <div class="char-name" id="ui-name">Name</div>
            <span class="char-job" id="ui-job">Job Title</span>
            <div class="level-row">
                <span data-t="l_lvl">Nivel Actual</span>
                <span class="lvl-big" id="ui-lvl">1</span>
            </div>
            <div class="xp-bar-bg"><div class="xp-bar-fill" id="ui-xp"></div></div>
            <div style="text-align:right; font-size:10px; color:#64748b; margin-top:4px" id="ui-xp-txt">0/1000</div>
        </div>

        <div class="stats">
            <div class="stat-box"><span class="s-val c-str" id="v-str">0</span><span class="s-lbl" data-t="s_str">FUERZA</span></div>
            <div class="stat-box"><span class="s-val c-cha" id="v-cha">0</span><span class="s-lbl" data-t="s_cha">CARISMA</span></div>
            <div class="stat-box"><span class="s-val c-int" id="v-int">0</span><span class="s-lbl" data-t="s_int">MENTE</span></div>
        </div>

        <div id="missions-area"></div>
        <div class="settings-link" onclick="openReset()" data-t="b_reset">Reiniciar / Reset</div>
    </div>
</div>

<div class="modal-bg" id="modal-reset">
    <div class="modal">
        <h3 style="color:var(--danger)" data-t="t_danger">‚ö†Ô∏è ZONA DE PELIGRO</h3>
        <p style="font-size:13px; color:#ccc" data-t="d_reset">Escribe tu nombre exacto:</p>
        <strong id="reset-hint" style="color:white; display:block; margin-bottom:10px">NAME</strong>
        <input type="text" id="inp-reset" style="text-align:center">
        <button class="btn-main" style="background:var(--danger)" onclick="confirmReset()" data-t="b_del">BORRAR</button>
        <button style="background:none; border:none; color:#888; text-decoration:underline; margin-top:10px" onclick="closeReset()">Cancelar</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* =========================================
   BASE DE DATOS OPTIMIZADA
   ========================================= */
const DB = {
    // === TRABAJO (Predefinidos) ===
    w_trades: {
        type: 'work', es: "Oficios / Construcci√≥n", en: "Trades / Construction",
        jobs: {
            cleaning: { es: "Limpieza / Pressure Washing", en: "Pressure Washing", m: [{s:'str',xp:100,t_es:"Mantenimiento Equipo",d_es:"Limpiar filtros/Aceite",t_en:"Gear Maint",d_en:"Clean filters/Oil"},{s:'str',xp:300,t_es:"Trabajo Facturable",d_es:"Completar servicio completo",t_en:"Billable Job",d_en:"Complete full service"},{s:'cha',xp:150,t_es:"Foto Portfolio",d_es:"Antes/Despu√©s para redes",t_en:"Portfolio Pic",d_en:"Before/After for social"},{s:'int',xp:200,t_es:"Cotizaci√≥n Precisa",d_es:"Medir y calcular margen",t_en:"Accurate Quote",d_en:"Measure & calc margin"}] },
            mechanic: { es: "Mec√°nica Automotriz", en: "Mechanic", m: [{s:'str',xp:150,t_es:"Servicio R√°pido",d_es:"Aceite/Frenos (1h)",t_en:"Quick Service",d_en:"Oil/Brakes (1h)"},{s:'int',xp:250,t_es:"Diagn√≥stico Complejo",d_es:"Hallar falla el√©ctrica/motor",t_en:"Diagnosis",d_en:"Find elec/engine fault"},{s:'cha',xp:100,t_es:"Asesor√≠a Cliente",d_es:"Explicar reparaci√≥n honestamente",t_en:"Client Advice",d_en:"Explain fix honestly"}] },
            construction: { es: "Construcci√≥n General", en: "Construction", m: [{s:'str',xp:200,t_es:"Jornada Completa",d_es:"8h labor f√≠sica intensa",t_en:"Full Day",d_en:"8h heavy labor"},{s:'int',xp:150,t_es:"Lectura de Planos",d_es:"Interpretar medidas exactas",t_en:"Blueprints",d_en:"Read exact specs"},{s:'cha',xp:150,t_es:"Reporte Avance",d_es:"Confirmar con jefe/cliente",t_en:"Status Report",d_en:"Confirm w/ boss"}] },
            electric: { es: "Electricista", en: "Electrician", m: [{s:'str',xp:150,t_es:"Cableado Nuevo",d_es:"Instalar l√≠nea/circuito",t_en:"New Wiring",d_en:"Install line/circuit"},{s:'int',xp:100,t_es:"Protocolo Seguridad",d_es:"Testear tierra/fugas",t_en:"Safety Check",d_en:"Test ground/leaks"}] },
            beauty: { es: "Belleza / Barber√≠a", en: "Beauty / Barber", m: [{s:'str',xp:100,t_es:"Marat√≥n de Pie",d_es:"3 clientes seguidos",t_en:"Standing Marathon",d_en:"3 clients in a row"},{s:'cha',xp:200,t_es:"Escucha Activa",d_es:"Conversaci√≥n emp√°tica",t_en:"Active Listen",d_en:"Empathetic chat"},{s:'int',xp:150,t_es:"Tendencia",d_es:"Estudiar nuevo estilo",t_en:"Trend Study",d_en:"Learn new style"}] },
            driver: { es: "Transporte / Chofer", en: "Driver", m: [{s:'str',xp:200,t_es:"Ruta Larga",d_es:"4h+ conducci√≥n segura",t_en:"Long Route",d_en:"4h+ safe drive"},{s:'int',xp:100,t_es:"Log√≠stica",d_es:"Optimizar ruta/gasolina",t_en:"Logistics",d_en:"Optimize route/gas"}] },
            food: { es: "Gastronom√≠a", en: "Culinary", m: [{s:'str',xp:200,t_es:"Servicio (Rush)",d_es:"Hora pico sin errores",t_en:"Service Rush",d_en:"Peak hour 0 errors"},{s:'int',xp:100,t_es:"Mise en place",d_es:"Organizar estaci√≥n 100%",t_en:"Mise en place",d_en:"Organize station 100%"}] }
        }
    },
    w_corp: {
        type: 'work', es: "Oficina / Negocios", en: "Corporate / Business",
        jobs: {
            sales: { es: "Ventas / Sales", en: "Sales", m: [{s:'cha',xp:100,t_es:"Prospecci√≥n",d_es:"10 llamadas/emails",t_en:"Prospecting",d_en:"10 calls/emails"},{s:'cha',xp:500,t_es:"CERRAR TRATO",d_es:"Contrato firmado/Pago",t_en:"CLOSE DEAL",d_en:"Contract signed"},{s:'int',xp:100,t_es:"CRM Admin",d_es:"Actualizar leads",t_en:"CRM Admin",d_en:"Update leads"}] },
            marketing: { es: "Marketing", en: "Marketing", m: [{s:'int',xp:150,t_es:"An√°lisis M√©tricas",d_es:"Revisar ROI/KPIs",t_en:"Metrics",d_en:"Check ROI/KPIs"},{s:'cha',xp:200,t_es:"Crear Campa√±a",d_es:"Lanzar ads/contenido",t_en:"Launch Campaign",d_en:"Launch ads/content"}] },
            admin: { es: "Administraci√≥n", en: "Admin", m: [{s:'int',xp:100,t_es:"Inbox Zero",d_es:"Procesar todos los emails",t_en:"Inbox Zero",d_en:"Process all emails"},{s:'cha',xp:150,t_es:"Gesti√≥n Reuniones",d_es:"Coordinar agendas complejas",t_en:"Meeting Mgmt",d_en:"Coordinate complex agenda"}] }
        }
    },
    w_tech: {
        type: 'work', es: "Tecnolog√≠a / IT", en: "Technology",
        jobs: {
            dev: { es: "Desarrollador", en: "Developer", m: [{s:'str',xp:100,t_es:"Deep Work",d_es:"1h c√≥digo (No distracciones)",t_en:"Deep Work",d_en:"1h code (No distractions)"},{s:'int',xp:150,t_es:"Refactor/Debug",d_es:"Mejorar c√≥digo existente",t_en:"Refactor",d_en:"Improve existing code"},{s:'str',xp:300,t_es:"Deploy",d_es:"Subir feature a producci√≥n",t_en:"Deploy",d_en:"Push feature to prod"}] },
            data: { es: "Analista de Datos", en: "Data Analyst", m: [{s:'int',xp:200,t_es:"Query Compleja",d_es:"SQL/Python script avanzado",t_en:"Complex Query",d_en:"Adv SQL/Python"},{s:'cha',xp:150,t_es:"Data Storytelling",d_es:"Presentar insights claros",t_en:"Storytelling",d_en:"Present clear insights"}] }
        }
    },

    // === ESTUDIO (Predefinidos) ===
    s_health: {
        type: 'study', es: "Salud (Medicina/Enfermer√≠a)", en: "Health (Med/Nursing)",
        jobs: {
            med: { es: "Medicina", en: "Medicine", m: [{s:'str',xp:300,t_es:"Guardia/Turno",d_es:"Rotaci√≥n hospitalaria",t_en:"Shift",d_en:"Hospital rotation"},{s:'int',xp:150,t_es:"Flashcards",d_es:"Repasar 50 tarjetas (Anki)",t_en:"Flashcards",d_en:"Review 50 cards"},{s:'cha',xp:100,t_es:"Anamnesis",d_es:"Practicar historia cl√≠nica",t_en:"History Taking",d_en:"Practice patient history"}] },
            psych: { es: "Psicolog√≠a", en: "Psychology", m: [{s:'int',xp:200,t_es:"Lectura Densa",d_es:"Resumir paper te√≥rico",t_en:"Heavy Reading",d_en:"Summarize theory paper"},{s:'cha',xp:150,t_es:"Roleplay",d_es:"Simular sesi√≥n terap√©utica",t_en:"Roleplay",d_en:"Simulate session"}] }
        }
    },
    s_eng: {
        type: 'study', es: "Ingenier√≠a", en: "Engineering",
        jobs: {
            general_eng: { es: "Estudiante Ingenier√≠a", en: "Engineering Student", m: [{s:'int',xp:100,t_es:"Problem Set",d_es:"Resolver 10 ejercicios",t_en:"Problem Set",d_en:"Solve 10 problems"},{s:'str',xp:200,t_es:"Proyecto Final",d_es:"Avanzar prototipo/c√≥digo",t_en:"Capstone",d_en:"Advance prototype"},{s:'int',xp:150,t_es:"Lab Report",d_es:"Documentar experimento",t_en:"Lab Report",d_en:"Document experiment"}] }
        }
    },
    s_law: {
        type: 'study', es: "Derecho / Leyes", en: "Law",
        jobs: {
            law: { es: "Derecho", en: "Law", m: [{s:'str',xp:200,t_es:"Lectura Casos",d_es:"Leer 3 sentencias completas",t_en:"Read Cases",d_en:"Read 3 full rulings"},{s:'cha',xp:150,t_es:"Debate",d_es:"Argumentar postura legal",t_en:"Moot Court",d_en:"Argue legal point"},{s:'int',xp:100,t_es:"Memorizar",d_es:"Art√≠culos/C√≥digos",t_en:"Memorize",d_en:"Articles/Codes"}] }
        }
    },
    s_hs: {
        type: 'study', es: "Secundaria / High School", en: "High School",
        jobs: {
            hs: { es: "Estudiante General", en: "Student", m: [{s:'str',xp:100,t_es:"Tarea Completa",d_es:"Sin copiar, a tiempo",t_en:"Homework",d_en:"No copying, on time"},{s:'int',xp:250,t_es:"Aprobar Examen",d_es:"Nota superior al promedio",t_en:"Pass Exam",d_en:"Above average grade"},{s:'str',xp:150,t_es:"Actividad Extra",d_es:"Deporte/Club/Arte (1h)",t_en:"Extra Curricular",d_en:"Sports/Club/Art (1h)"}] }
        }
    },

    // === OPCI√ìN PERSONALIZADA ===
    custom: {
        type: 'any', es: "OTRO / PERSONALIZADO", en: "OTHER / CUSTOM",
        jobs: { custom_job: { es: "Definir mi rol...", en: "Define my role...", m: [] } }
    }
};

/* --- TEXTOS UI --- */
const T = {
    es: { t_create:"CREA TU PERFIL", l_name:"Nombre", l_clan:"Clan", l_cat:"Sector / Facultad", l_job:"Rol / Carrera", b_start:"EMPEZAR", l_lvl:"Nivel", s_str:"FUERZA", s_cha:"CARISMA", s_int:"MENTE", b_reset:"Reiniciar Todo", t_danger:"ZONA DE PELIGRO", d_reset:"Escribe tu nombre para borrar:", b_del:"BORRAR", l_custom:"Escribe tu Rol Exacto:", clans:["ü¶Å Leones (Liderazgo)","ü¶ä Zorros (Astucia)","üîÆ Magos (Creatividad)","üêç Serpientes (Ambici√≥n)","üêê Cabras (Persistencia)"] },
    en: { t_create:"CREATE PROFILE", l_name:"Name", l_clan:"Clan", l_cat:"Sector / Faculty", l_job:"Role / Major", b_start:"START", l_lvl:"Level", s_str:"STRENGTH", s_cha:"CHARISMA", s_int:"MIND", b_reset:"Reset All", t_danger:"DANGER ZONE", d_reset:"Type name to delete:", b_del:"DELETE", l_custom:"Type your Exact Role:", clans:["ü¶Å Lions (Leadership)","ü¶ä Foxes (Cunning)","üîÆ Mages (Creativity)","üêç Serpents (Ambition)","üêê Goats (Persistence)"] }
};

let lang = 'es', mode = 'work', player = { name:"", clan:"", cat:"", job:"", customName:"", lvl:1, xp:0, next:1000, stats:{str:0, cha:0, int:0} };

window.onload = () => {
    try {
        lang = localStorage.getItem('rpg_lang') || 'es';
        setLang(lang, false);
        const clanSel = document.getElementById('inp-clan');
        clanSel.innerHTML = "";
        T[lang].clans.forEach((c, i) => { let o = document.createElement('option'); o.value = i; o.innerText = c; clanSel.appendChild(o); });

        const save = localStorage.getItem('rpg_save_v9');
        if(save) {
            player = JSON.parse(save);
            if(!player.stats) player.stats = {str:0, cha:0, int:0};
            initGame();
        } else {
            document.getElementById('screen-create').classList.add('active');
            setMode('work');
        }
    } catch(e) { document.getElementById('error-msg').style.display='block'; }
};

function setMode(m) {
    mode = m;
    document.getElementById('t-work').className = m === 'work' ? 'mode-btn active' : 'mode-btn';
    document.getElementById('t-study').className = m === 'study' ? 'mode-btn active' : 'mode-btn';
    
    const catSel = document.getElementById('inp-category');
    catSel.innerHTML = "";
    Object.keys(DB).forEach(k => {
        if(DB[k].type === m || DB[k].type === 'any') {
            let opt = document.createElement('option');
            opt.value = k; opt.innerText = DB[k][lang];
            catSel.appendChild(opt);
        }
    });
    updateSubSelect();
}

function updateSubSelect() {
    const cat = document.getElementById('inp-category').value;
    const jobSel = document.getElementById('inp-job');
    jobSel.innerHTML = "";
    if(cat && DB[cat]) {
        Object.keys(DB[cat].jobs).forEach(k => {
            let opt = document.createElement('option');
            opt.value = k; opt.innerText = DB[cat].jobs[k][lang];
            jobSel.appendChild(opt);
        });
    }
    checkCustomJob();
}

function checkCustomJob() {
    const cat = document.getElementById('inp-category').value;
    const box = document.getElementById('custom-area');
    if(cat === 'custom') box.classList.add('show');
    else box.classList.remove('show');
}

function setLang(l, r=true) {
    lang = l; localStorage.setItem('rpg_lang', l);
    document.getElementById('btn-es').classList.toggle('active', l==='es');
    document.getElementById('btn-en').classList.toggle('active', l==='en');
    document.querySelectorAll('[data-t]').forEach(e => { if(T[l][e.dataset.t]) e.innerText = T[l][e.dataset.t]; });
    if(r) location.reload();
}

function startGame() {
    const n = document.getElementById('inp-name').value;
    if(!n) return alert("Name required");
    player.name = n;
    player.clan = T[lang].clans[document.getElementById('inp-clan').value];
    player.cat = document.getElementById('inp-category').value;
    player.job = document.getElementById('inp-job').value;
    player.mode = mode; // Guardamos el modo elegido (work/study)
    
    if(player.cat === 'custom') {
        const cText = document.getElementById('inp-custom-text').value;
        if(!cText) return alert("Role required");
        player.customName = cText;
    } else {
        player.customName = "";
    }
    save(); initGame();
}

function initGame() {
    document.getElementById('screen-create').classList.remove('active');
    document.getElementById('screen-game').classList.add('active');
    renderUI();
}

function renderUI() {
    document.getElementById('ui-name').innerText = player.name;
    let jName = player.job;
    if(player.cat === 'custom' && player.customName) {
        jName = player.customName.toUpperCase();
    } else {
        try { jName = DB[player.cat].jobs[player.job][lang]; } catch(e){}
    }
    document.getElementById('ui-job').innerText = jName;
    document.getElementById('ui-clan').innerText = player.clan.split(' ')[0]+" "+player.clan.split(' ')[1];
    document.getElementById('ui-lvl').innerText = player.lvl;
    document.getElementById('v-str').innerText = player.stats.str;
    document.getElementById('v-cha').innerText = player.stats.cha;
    document.getElementById('v-int').innerText = player.stats.int;
    const pct = (player.xp / player.next)*100;
    document.getElementById('ui-xp').style.width = pct+"%";
    document.getElementById('ui-xp-txt').innerText = Math.floor(player.xp)+"/"+player.next;
    document.getElementById('reset-hint').innerText = player.name;
    renderMissions();
}

function renderMissions() {
    const area = document.getElementById('missions-area');
    area.innerHTML = "";
    let missions = [];

    if(player.cat === 'custom') {
        // === MOTOR DE GENERACI√ìN REALISTA V9.0 ===
        if(player.mode === 'work') {
            // Misiones Universales de Productividad LABORAL
            missions = [
                {s:'str', xp:150, t_es:"Deep Work (90 min)", d_es:"Sin tel√©fono/distracciones", t_en:"Deep Work (90m)", d_en:"No phone/distractions"},
                {s:'str', xp:100, t_es:"Comerse la Rana", d_es:"Hacer la tarea m√°s dif√≠cil 1ro", t_en:"Eat the Frog", d_en:"Do hardest task 1st"},
                {s:'int', xp:100, t_es:"Inbox Zero / Orden", d_es:"Limpiar emails o espacio f√≠sico", t_en:"Inbox Zero / Tidy", d_en:"Clear emails or space"},
                {s:'int', xp:200, t_es:"Mejora de Habilidad", d_es:"30 min estudiando tu rubro", t_en:"Skill Up", d_en:"30m study your field"},
                {s:'cha', xp:150, t_es:"Networking Activo", d_es:"Contactar 3 personas/clientes", t_en:"Active Networking", d_en:"Reach out to 3 people"},
                {s:'cha', xp:100, t_es:"Reporte de Estado", d_es:"Comunicar avance a equipo", t_en:"Status Update", d_en:"Communicate progress"}
            ];
        } else {
            // Misiones Universales de ESTUDIO Efectivo
            missions = [
                {s:'str', xp:150, t_es:"Pomodoro (4 ciclos)", d_es:"2 horas de estudio con pausas", t_en:"Pomodoro (4x)", d_en:"2h study with breaks"},
                {s:'int', xp:100, t_es:"Active Recall", d_es:"Autoevaluaci√≥n sin mirar notas", t_en:"Active Recall", d_en:"Quiz self no notes"},
                {s:'int', xp:200, t_es:"Resumen Feynman", d_es:"Explicar tema en lenguaje simple", t_en:"Feynman Tech", d_en:"Explain simply"},
                {s:'int', xp:150, t_es:"Pr√°ctica Deliberada", d_es:"Resolver ejercicios dif√≠ciles", t_en:"Practice", d_en:"Do hard exercises"},
                {s:'cha', xp:150, t_es:"Ense√±ar a compa√±ero", d_es:"Explicar un tema a otro", t_en:"Teach Peer", d_en:"Explain topic to peer"},
                {s:'cha', xp:100, t_es:"Preguntar en Clase", d_es:"Participar activamente", t_en:"Ask Question", d_en:"Participate in class"}
            ];
        }
    } else {
        try { missions = DB[player.cat].jobs[player.job].m; } catch(e){}
    }

    ['str', 'cha', 'int'].forEach(stat => {
        const ms = missions.filter(m => m.s === stat);
        if(ms.length > 0) {
            const grp = document.createElement('div'); grp.className='m-group';
            const h = document.createElement('div'); h.className='m-head'; h.innerText=T[lang]['s_'+stat]; grp.appendChild(h);
            ms.forEach(m => {
                const b = document.createElement('div'); b.className='m-btn'; b.onclick=()=>gain(m.xp, m.s);
                b.innerHTML = `<div class="m-info"><span class="m-title">${lang==='es'?m.t_es:m.t_en}</span><span class="m-desc">${lang==='es'?m.d_es:m.d_en}</span></div><div class="xp-badge">+${m.xp}</div>`;
                grp.appendChild(b);
            });
            area.appendChild(grp);
        }
    });
}

function gain(xp, s) {
    player.xp+=xp; player.stats[s]++;
    let m = `+${xp} XP`;
    if(player.xp >= player.next) { player.lvl++; player.xp-=player.next; player.next=Math.floor(player.next*1.2); m="üéâ LEVEL UP!"; }
    save(); renderUI(); toast(m);
}

function toast(m) {
    const t = document.getElementById('toast'); t.innerText=m; t.style.opacity=1; t.style.bottom="40px";
    setTimeout(()=>{t.style.opacity=0;t.style.bottom="30px"}, 2000);
}

function save() { localStorage.setItem('rpg_save_v9', JSON.stringify(player)); }
function openReset() { document.getElementById('modal-reset').style.display='flex'; }
function closeReset() { document.getElementById('modal-reset').style.display='none'; }
function confirmReset() {
    if(document.getElementById('inp-reset').value === player.name) { localStorage.removeItem('rpg_save_v9'); location.reload(); }
}
</script>
</body>
</html>
