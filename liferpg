<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG Life: Archetypes v10</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #3b82f6; --accent: #8b5cf6; --gold: #f59e0b; --danger: #ef4444; --text: #f8fafc; --muted: #94a3b8; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 420px; position: relative; padding-bottom: 50px; }
        
        .lang-switch { position: absolute; top: -35px; right: 0; display: flex; gap: 5px; }
        .lang-btn { background: var(--card); border: 1px solid #334155; color: var(--muted); padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; cursor: pointer; }
        .lang-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .screen { display: none; animation: fade 0.4s; }
        .active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h1 { text-align: center; color: var(--primary); margin: 0 0 15px 0; font-size: 24px; }
        label { display: block; color: var(--muted); font-size: 11px; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
        select, input { width: 100%; padding: 12px; background: var(--card); border: 2px solid #334155; color: white; border-radius: 8px; font-size: 15px; margin-bottom: 15px; outline: none; box-sizing: border-box; }
        select:focus, input:focus { border-color: var(--primary); }
        
        .btn-main { background: linear-gradient(135deg, var(--primary), var(--accent)); width: 100%; padding: 14px; border: none; border-radius: 10px; color: white; font-weight: bold; font-size: 16px; margin-top: 10px; cursor: pointer; transition: 0.2s; }
        
        .mode-toggle { display: flex; background: var(--card); border-radius: 10px; padding: 4px; margin-bottom: 20px; border: 1px solid #334155; }
        .mode-btn { flex: 1; border: none; background: none; color: var(--muted); padding: 10px; font-weight: bold; font-size: 13px; cursor: pointer; border-radius: 8px; }
        .mode-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* CUSTOM AREA STYLES */
        #custom-area { display: none; background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 10px; border: 1px dashed var(--primary); margin-bottom: 15px; }
        #custom-area.show { display: block; animation: fade 0.3s; }

        .profile-card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #334155; position: relative; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .clan-tag { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-size: 10px; color: var(--accent); border: 1px solid var(--accent); }
        .char-name { font-size: 22px; font-weight: 800; margin-bottom: 4px; }
        .char-job { color: var(--muted); font-size: 13px; display: block; margin-bottom: 12px; font-style: italic; }
        
        .level-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 6px; font-size: 12px; color: var(--muted); }
        .lvl-big { font-size: 26px; color: var(--gold); font-weight: bold; line-height: 1; }
        .xp-bar-bg { background: #0f172a; height: 10px; border-radius: 5px; overflow: hidden; border: 1px solid #334155; }
        .xp-bar-fill { background: linear-gradient(90deg, var(--gold), #fcd34d); height: 100%; width: 0%; transition: width 0.4s cubic-bezier(0.25, 1, 0.5, 1); }

        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .stat-box { background: #0f172a; padding: 12px 5px; border-radius: 10px; text-align: center; border: 1px solid #334155; }
        .s-val { font-size: 22px; font-weight: bold; display: block; line-height: 1.1; }
        .s-lbl { font-size: 9px; color: var(--muted); font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .c-str { color: #ef4444; } .c-cha { color: #f472b6; } .c-int { color: #3b82f6; }

        .m-group { margin-bottom: 15px; }
        .m-head { font-size: 10px; color: var(--muted); font-weight: bold; text-transform: uppercase; border-bottom: 1px solid #334155; margin-bottom: 8px; padding-bottom: 4px; letter-spacing: 1px; }
        .m-btn { 
            background: var(--card); border: 1px solid #334155; padding: 14px; border-radius: 12px; 
            margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; 
            color: white; text-align: left; cursor: pointer; transition: 0.1s; position: relative; overflow: hidden;
        }
        .m-btn:active { transform: scale(0.98); background: #334155; border-color: var(--primary); }
        .m-info { flex: 1; margin-right: 10px; }
        .m-title { font-size: 14px; font-weight: 600; display: block; margin-bottom: 2px; }
        .m-desc { font-size: 11px; color: var(--muted); }
        .xp-badge { background: rgba(255,255,255,0.08); padding: 6px 10px; border-radius: 8px; font-size: 12px; color: var(--gold); font-weight: bold; min-width: 50px; text-align: center; }

        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--gold); color: black; padding: 10px 20px; border-radius: 30px; font-weight: bold; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 99; width: 80%; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .settings-link { display: block; text-align: center; color: #475569; font-size: 12px; text-decoration: underline; margin-top: 20px; cursor: pointer; padding: 10px; }
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        .modal { background: var(--card); padding: 25px; border-radius: 15px; width: 100%; max-width: 320px; text-align: center; border: 1px solid var(--danger); }
        #error-msg { display:none; color:white; background:#ef4444; padding:20px; position:fixed; top:0; left:0; width:100%; z-index:9999; text-align:center; }
    </style>
</head>
<body>

<div id="error-msg">Error de datos. <button onclick="localStorage.clear();location.reload()">Reset</button></div>

<div class="container">
    <div class="lang-switch">
        <button class="lang-btn active" id="btn-es" onclick="setLang('es')">ES</button>
        <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
    </div>

    <div id="screen-create" class="screen">
        <h1 data-t="t_create">CREA TU PERFIL</h1>
        
        <div class="mode-toggle">
            <button class="mode-btn active" id="t-work" onclick="setMode('work')">üëî TRABAJO</button>
            <button class="mode-btn" id="t-study" onclick="setMode('study')">üéì ESTUDIO</button>
        </div>

        <label data-t="l_name">Nombre</label>
        <input type="text" id="inp-name" placeholder="...">
        
        <label data-t="l_clan">Clan</label>
        <select id="inp-clan"></select>

        <label id="lbl-cat" data-t="l_cat">Industria / Facultad</label>
        <select id="inp-category" onchange="updateSubSelect()"></select>

        <label id="lbl-job" data-t="l_job">Rol / Carrera</label>
        <select id="inp-job" onchange="checkCustomJob()"></select>

        <div id="custom-area">
            <label style="color:var(--primary)">1. Escribe tu Rol:</label>
            <input type="text" id="inp-custom-text" placeholder="Ej: Chef, Carpintero...">
            
            <label style="color:var(--primary)">2. ¬øC√≥mo es tu trabajo?:</label>
            <select id="inp-custom-type">
                <option value="manual">üî® Manual / Artesano (Chef, Carpintero)</option>
                <option value="office">üíª Oficina / Mental (Contador, Writer)</option>
                <option value="service">ü§ù Servicio / Gente (Mesero, Recepci√≥n)</option>
                <option value="action">‚ö° F√≠sico / Acci√≥n (Bombero, Atleta)</option>
            </select>
        </div>

        <button class="btn-main" onclick="startGame()" data-t="b_start">COMENZAR AVENTURA</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="profile-card">
            <span class="clan-tag" id="ui-clan">Clan</span>
            <div class="char-name" id="ui-name">Name</div>
            <span class="char-job" id="ui-job">Job Title</span>
            <div class="level-row">
                <span data-t="l_lvl">Nivel Actual</span>
                <span class="lvl-big" id="ui-lvl">1</span>
            </div>
            <div class="xp-bar-bg"><div class="xp-bar-fill" id="ui-xp"></div></div>
            <div style="text-align:right; font-size:10px; color:#64748b; margin-top:4px" id="ui-xp-txt">0/1000</div>
        </div>

        <div class="stats">
            <div class="stat-box"><span class="s-val c-str" id="v-str">0</span><span class="s-lbl" data-t="s_str">FUERZA</span></div>
            <div class="stat-box"><span class="s-val c-cha" id="v-cha">0</span><span class="s-lbl" data-t="s_cha">CARISMA</span></div>
            <div class="stat-box"><span class="s-val c-int" id="v-int">0</span><span class="s-lbl" data-t="s_int">MENTE</span></div>
        </div>

        <div id="missions-area"></div>
        <div class="settings-link" onclick="openReset()" data-t="b_reset">Reiniciar / Reset</div>
    </div>
</div>

<div class="modal-bg" id="modal-reset">
    <div class="modal">
        <h3 style="color:var(--danger)" data-t="t_danger">‚ö†Ô∏è ZONA DE PELIGRO</h3>
        <p style="font-size:13px; color:#ccc" data-t="d_reset">Escribe tu nombre exacto:</p>
        <strong id="reset-hint" style="color:white; display:block; margin-bottom:10px">NAME</strong>
        <input type="text" id="inp-reset" style="text-align:center">
        <button class="btn-main" style="background:var(--danger)" onclick="confirmReset()" data-t="b_del">BORRAR</button>
        <button style="background:none; border:none; color:#888; text-decoration:underline; margin-top:10px" onclick="closeReset()">Cancelar</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* =========================================
   BASE DE DATOS V10
   ========================================= */
const DB = {
    // === TRABAJO (Predefinidos) ===
    w_trades: {
        type: 'work', es: "Oficios / Construcci√≥n", en: "Trades / Construction",
        jobs: {
            cleaning: { es: "Limpieza / PW", en: "Pressure Washing", m: [{s:'str',xp:100,t_es:"Prep. Equipo",d_es:"Mezclar qu√≠micos/Aceite",t_en:"Prep Gear",d_en:"Mix chems/Oil"},{s:'str',xp:300,t_es:"Trabajo Facturable",d_es:"Completar servicio",t_en:"Billable Job",d_en:"Complete service"},{s:'cha',xp:150,t_es:"Foto Portfolio",d_es:"Antes/Despu√©s",t_en:"Portfolio Pic",d_en:"Before/After"},{s:'int',xp:200,t_es:"Cotizaci√≥n",d_es:"Medir y calcular",t_en:"Quote",d_en:"Measure & calc"}] },
            mechanic: { es: "Mec√°nica", en: "Mechanic", m: [{s:'str',xp:150,t_es:"Servicio R√°pido",d_es:"Aceite/Frenos (1h)",t_en:"Quick Service",d_en:"Oil/Brakes (1h)"},{s:'int',xp:250,t_es:"Diagn√≥stico",d_es:"Hallar falla exacta",t_en:"Diagnosis",d_en:"Find exact fault"},{s:'cha',xp:100,t_es:"Asesor√≠a",d_es:"Explicar reparaci√≥n",t_en:"Advice",d_en:"Explain fix"}] },
            construction: { es: "Construcci√≥n", en: "Construction", m: [{s:'str',xp:200,t_es:"Jornada Dura",d_es:"8h labor f√≠sica",t_en:"Hard Day",d_en:"8h heavy labor"},{s:'int',xp:150,t_es:"Lectura Planos",d_es:"Medidas exactas",t_en:"Blueprints",d_en:"Read specs"},{s:'cha',xp:150,t_es:"Reporte",d_es:"Confirmar avance",t_en:"Report",d_en:"Confirm progress"}] },
            food: { es: "Gastronom√≠a", en: "Culinary", m: [{s:'str',xp:200,t_es:"Servicio (Rush)",d_es:"Hora pico 0 errores",t_en:"Service Rush",d_en:"Peak hour 0 errors"},{s:'str',xp:100,t_es:"Mise en place",d_es:"Organizar estaci√≥n",t_en:"Mise en place",d_en:"Organize station"}] }
        }
    },
    w_corp: {
        type: 'work', es: "Oficina / Negocios", en: "Corporate / Business",
        jobs: {
            sales: { es: "Ventas", en: "Sales", m: [{s:'cha',xp:100,t_es:"Prospecci√≥n",d_es:"10 llamadas/emails",t_en:"Prospecting",d_en:"10 calls/emails"},{s:'cha',xp:500,t_es:"CERRAR TRATO",d_es:"Contrato firmado",t_en:"CLOSE DEAL",d_en:"Contract signed"},{s:'int',xp:100,t_es:"CRM Admin",d_es:"Actualizar leads",t_en:"CRM Admin",d_en:"Update leads"}] },
            admin: { es: "Administraci√≥n", en: "Admin", m: [{s:'int',xp:100,t_es:"Inbox Zero",d_es:"Procesar emails",t_en:"Inbox Zero",d_en:"Process emails"},{s:'cha',xp:150,t_es:"Gesti√≥n",d_es:"Coordinar agendas",t_en:"Mgmt",d_en:"Coordinate agenda"}] }
        }
    },
    w_tech: {
        type: 'work', es: "Tecnolog√≠a", en: "Technology",
        jobs: {
            dev: { es: "Desarrollador", en: "Developer", m: [{s:'str',xp:100,t_es:"Deep Work",d_es:"1h c√≥digo puro",t_en:"Deep Work",d_en:"1h pure code"},{s:'int',xp:150,t_es:"Debug",d_es:"Arreglar error",t_en:"Debug",d_en:"Fix bug"},{s:'str',xp:300,t_es:"Deploy",d_es:"Subir a producci√≥n",t_en:"Deploy",d_en:"Push to prod"}] }
        }
    },

    // === ESTUDIO (Predefinidos) ===
    s_health: {
        type: 'study', es: "Salud (Medicina)", en: "Health (Med)",
        jobs: {
            med: { es: "Medicina", en: "Medicine", m: [{s:'str',xp:300,t_es:"Guardia",d_es:"Rotaci√≥n hospital",t_en:"Shift",d_en:"Hospital rotation"},{s:'int',xp:150,t_es:"Flashcards",d_es:"Repasar 50 tarjetas",t_en:"Flashcards",d_en:"Review 50 cards"},{s:'cha',xp:100,t_es:"Anamnesis",d_es:"Historia cl√≠nica",t_en:"History",d_en:"Patient history"}] }
        }
    },
    s_eng: {
        type: 'study', es: "Ingenier√≠a", en: "Engineering",
        jobs: {
            general_eng: { es: "Ingenier√≠a General", en: "General Eng", m: [{s:'int',xp:100,t_es:"Ejercicios",d_es:"Resolver 10 problemas",t_en:"Problem Set",d_en:"Solve 10 problems"},{s:'str',xp:200,t_es:"Proyecto",d_es:"Avanzar prototipo",t_en:"Project",d_en:"Advance prototype"}] }
        }
    },
    
    // === OPCI√ìN PERSONALIZADA ===
    custom: {
        type: 'any', es: "OTRO / PERSONALIZADO", en: "OTHER / CUSTOM",
        jobs: { custom_job: { es: "Definir mi rol...", en: "Define my role...", m: [] } }
    }
};

/* --- TEXTOS UI --- */
const T = {
    es: { t_create:"CREA TU PERFIL", l_name:"Nombre", l_clan:"Clan", l_cat:"Sector / Facultad", l_job:"Rol / Carrera", b_start:"EMPEZAR", l_lvl:"Nivel", s_str:"FUERZA", s_cha:"CARISMA", s_int:"MENTE", b_reset:"Reiniciar Todo", t_danger:"ZONA DE PELIGRO", d_reset:"Escribe tu nombre para borrar:", b_del:"BORRAR", l_custom:"Escribe tu Rol Exacto:", clans:["ü¶Å Leones (Liderazgo)","ü¶ä Zorros (Astucia)","üîÆ Magos (Creatividad)","üêç Serpientes (Ambici√≥n)","üêê Cabras (Persistencia)"] },
    en: { t_create:"CREATE PROFILE", l_name:"Name", l_clan:"Clan", l_cat:"Sector / Faculty", l_job:"Role / Major", b_start:"START", l_lvl:"Level", s_str:"STRENGTH", s_cha:"CHARISMA", s_int:"MIND", b_reset:"Reset All", t_danger:"DANGER ZONE", d_reset:"Type name to delete:", b_del:"DELETE", l_custom:"Type your Exact Role:", clans:["ü¶Å Lions (Leadership)","ü¶ä Foxes (Cunning)","üîÆ Mages (Creativity)","üêç Serpents (Ambition)","üêê Goats (Persistence)"] }
};

let lang = 'es', mode = 'work', player = { name:"", clan:"", cat:"", job:"", customName:"", customType:"", lvl:1, xp:0, next:1000, stats:{str:0, cha:0, int:0} };

window.onload = () => {
    try {
        lang = localStorage.getItem('rpg_lang') || 'es';
        setLang(lang, false);
        const clanSel = document.getElementById('inp-clan');
        clanSel.innerHTML = "";
        T[lang].clans.forEach((c, i) => { let o = document.createElement('option'); o.value = i; o.innerText = c; clanSel.appendChild(o); });

        const save = localStorage.getItem('rpg_save_v10');
        if(save) {
            player = JSON.parse(save);
            if(!player.stats) player.stats = {str:0, cha:0, int:0};
            initGame();
        } else {
            document.getElementById('screen-create').classList.add('active');
            setMode('work');
        }
    } catch(e) { document.getElementById('error-msg').style.display='block'; }
};

function setMode(m) {
    mode = m;
    document.getElementById('t-work').className = m === 'work' ? 'mode-btn active' : 'mode-btn';
    document.getElementById('t-study').className = m === 'study' ? 'mode-btn active' : 'mode-btn';
    
    const catSel = document.getElementById('inp-category');
    catSel.innerHTML = "";
    Object.keys(DB).forEach(k => {
        if(DB[k].type === m || DB[k].type === 'any') {
            let opt = document.createElement('option');
            opt.value = k; opt.innerText = DB[k][lang];
            catSel.appendChild(opt);
        }
    });
    updateSubSelect();
}

function updateSubSelect() {
    const cat = document.getElementById('inp-category').value;
    const jobSel = document.getElementById('inp-job');
    jobSel.innerHTML = "";
    if(cat && DB[cat]) {
        Object.keys(DB[cat].jobs).forEach(k => {
            let opt = document.createElement('option');
            opt.value = k; opt.innerText = DB[cat].jobs[k][lang];
            jobSel.appendChild(opt);
        });
    }
    checkCustomJob();
}

function checkCustomJob() {
    const cat = document.getElementById('inp-category').value;
    const box = document.getElementById('custom-area');
    if(cat === 'custom') box.classList.add('show');
    else box.classList.remove('show');
}

function setLang(l, r=true) {
    lang = l; localStorage.setItem('rpg_lang', l);
    document.getElementById('btn-es').classList.toggle('active', l==='es');
    document.getElementById('btn-en').classList.toggle('active', l==='en');
    document.querySelectorAll('[data-t]').forEach(e => { if(T[l][e.dataset.t]) e.innerText = T[l][e.dataset.t]; });
    if(r) location.reload();
}

function startGame() {
    const n = document.getElementById('inp-name').value;
    if(!n) return alert("Name required");
    player.name = n;
    player.clan = T[lang].clans[document.getElementById('inp-clan').value];
    player.cat = document.getElementById('inp-category').value;
    player.job = document.getElementById('inp-job').value;
    player.mode = mode;
    
    if(player.cat === 'custom') {
        const cText = document.getElementById('inp-custom-text').value;
        if(!cText) return alert("Role required");
        player.customName = cText;
        player.customType = document.getElementById('inp-custom-type').value; // GUARDAR EL TIPO
    } else {
        player.customName = "";
        player.customType = "";
    }
    save(); initGame();
}

function initGame() {
    document.getElementById('screen-create').classList.remove('active');
    document.getElementById('screen-game').classList.add('active');
    renderUI();
}

function renderUI() {
    document.getElementById('ui-name').innerText = player.name;
    let jName = player.job;
    if(player.cat === 'custom' && player.customName) {
        jName = player.customName.toUpperCase();
    } else {
        try { jName = DB[player.cat].jobs[player.job][lang]; } catch(e){}
    }
    document.getElementById('ui-job').innerText = jName;
    document.getElementById('ui-clan').innerText = player.clan.split(' ')[0]+" "+player.clan.split(' ')[1];
    document.getElementById('ui-lvl').innerText = player.lvl;
    document.getElementById('v-str').innerText = player.stats.str;
    document.getElementById('v-cha').innerText = player.stats.cha;
    document.getElementById('v-int').innerText = player.stats.int;
    const pct = (player.xp / player.next)*100;
    document.getElementById('ui-xp').style.width = pct+"%";
    document.getElementById('ui-xp-txt').innerText = Math.floor(player.xp)+"/"+player.next;
    document.getElementById('reset-hint').innerText = player.name;
    renderMissions();
}

function renderMissions() {
    const area = document.getElementById('missions-area');
    area.innerHTML = "";
    let missions = [];

    if(player.cat === 'custom') {
        // === MOTOR DE ARQUETIPOS V10 ===
        const type = player.customType; 
        
        if (type === 'manual') { // CHEF, CARPINTERO, PINTOR
            missions = [
                {s:'str', xp:100, t_es:"Prep. Herramientas/Ingredientes", d_es:"Organizar todo antes de empezar (Mise en place)", t_en:"Prep Tools/Ingredients", d_en:"Organize everything (Mise en place)"},
                {s:'str', xp:200, t_es:"Ejecuci√≥n / Trabajo", d_es:"Periodo de trabajo manual intenso", t_en:"Execution / Labor", d_en:"Intense manual work period"},
                {s:'int', xp:100, t_es:"Limpieza / Mantenimiento", d_es:"Limpiar √°rea o afilar/reparar equipo", t_en:"Clean / Maintain", d_en:"Clean area or fix gear"},
                {s:'int', xp:150, t_es:"Control de Calidad", d_es:"Revisar detalle final o sabor", t_en:"Quality Check", d_en:"Check final detail/taste"},
                {s:'cha', xp:150, t_es:"Coordinaci√≥n Equipo", d_es:"Comunicar orden o estado", t_en:"Team Sync", d_en:"Communicate order/status"}
            ];
        } else if (type === 'office') { // CONTADOR, ESCRITOR
            missions = [
                {s:'str', xp:100, t_es:"Deep Work (Foco)", d_es:"90 min sin distracciones", t_en:"Deep Work", d_en:"90 min no distractions"},
                {s:'int', xp:100, t_es:"Organizaci√≥n / Email", d_es:"Limpiar pendientes y agenda", t_en:"Inbox / Plan", d_en:"Clear tasks/agenda"},
                {s:'int', xp:200, t_es:"An√°lisis / Creaci√≥n", d_es:"Terminar documento o reporte", t_en:"Analysis / Create", d_en:"Finish doc or report"},
                {s:'cha', xp:150, t_es:"Reuni√≥n Efectiva", d_es:"Reuni√≥n productiva (con notas)", t_en:"Effective Meeting", d_en:"Meeting with notes"}
            ];
        } else if (type === 'service') { // MESERO, RECEPCI√ìN
            missions = [
                {s:'cha', xp:100, t_es:"Atenci√≥n Cliente", d_es:"Atender con energ√≠a positiva", t_en:"Client Service", d_en:"Serve with energy"},
                {s:'cha', xp:200, t_es:"Resoluci√≥n Conflicto", d_es:"Manejar cliente dif√≠cil con calma", t_en:"Conflict Solve", d_en:"Handle difficult client"},
                {s:'str', xp:150, t_es:"Rush / Hora Pico", d_es:"Mantener ritmo bajo presi√≥n", t_en:"Rush Hour", d_en:"Keep pace under pressure"},
                {s:'int', xp:100, t_es:"Cierre / Caja", d_es:"Cuadrar cuentas o inventario", t_en:"Closing", d_en:"Balance cash/stock"}
            ];
        } else { // ACCI√ìN (BOMBERO, ATLETA)
            missions = [
                {s:'str', xp:200, t_es:"Entrenamiento F√≠sico", d_es:"Mantener condici√≥n √≥ptima", t_en:"Physical Train", d_en:"Keep optimal shape"},
                {s:'int', xp:150, t_es:"Estudio Protocolos", d_es:"Repasar estrategia/reglas", t_en:"Study Protocol", d_en:"Review strategy/rules"},
                {s:'str', xp:300, t_es:"Acci√≥n / Evento", d_es:"Responder a emergencia o competir", t_en:"Action / Event", d_en:"Respond to emergency/compete"}
            ];
        }

    } else {
        try { missions = DB[player.cat].jobs[player.job].m; } catch(e){}
    }

    ['str', 'cha', 'int'].forEach(stat => {
        const ms = missions.filter(m => m.s === stat);
        if(ms.length > 0) {
            const grp = document.createElement('div'); grp.className='m-group';
            const h = document.createElement('div'); h.className='m-head'; h.innerText=T[lang]['s_'+stat]; grp.appendChild(h);
            ms.forEach(m => {
                const b = document.createElement('div'); b.className='m-btn'; b.onclick=()=>gain(m.xp, m.s);
                b.innerHTML = `<div class="m-info"><span class="m-title">${lang==='es'?m.t_es:m.t_en}</span><span class="m-desc">${lang==='es'?m.d_es:m.d_en}</span></div><div class="xp-badge">+${m.xp}</div>`;
                grp.appendChild(b);
            });
            area.appendChild(grp);
        }
    });
}

function gain(xp, s) {
    player.xp+=xp; player.stats[s]++;
    let m = `+${xp} XP`;
    if(player.xp >= player.next) { player.lvl++; player.xp-=player.next; player.next=Math.floor(player.next*1.2); m="üéâ LEVEL UP!"; }
    save(); renderUI(); toast(m);
}

function toast(m) {
    const t = document.getElementById('toast'); t.innerText=m; t.style.opacity=1; t.style.bottom="40px";
    setTimeout(()=>{t.style.opacity=0;t.style.bottom="30px"}, 2000);
}

function save() { localStorage.setItem('rpg_save_v10', JSON.stringify(player)); }
function openReset() { document.getElementById('modal-reset').style.display='flex'; }
function closeReset() { document.getElementById('modal-reset').style.display='none'; }
function confirmReset() {
    if(document.getElementById('inp-reset').value === player.name) { localStorage.removeItem('rpg_save_v10'); location.reload(); }
}
</script>
</body>
</html>
