<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG Life: Ultimate Fixed</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #3b82f6; --accent: #8b5cf6; --gold: #f59e0b; --danger: #ef4444; --text: #f8fafc; --muted: #94a3b8; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 450px; position: relative; padding-bottom: 50px; }
        
        .lang-switch { position: absolute; top: -35px; right: 0; display: flex; gap: 5px; }
        .lang-btn { background: var(--card); border: 1px solid #334155; color: var(--muted); padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; cursor: pointer; }
        .lang-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .screen { display: none; animation: fade 0.4s; }
        .active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h1 { text-align: center; color: var(--primary); margin: 0 0 15px 0; font-size: 24px; }
        label { display: block; color: var(--muted); font-size: 11px; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
        select, input { width: 100%; padding: 12px; background: var(--card); border: 2px solid #334155; color: white; border-radius: 8px; font-size: 15px; margin-bottom: 15px; outline: none; box-sizing: border-box; }
        select:focus, input:focus { border-color: var(--primary); }
        
        .btn-main { background: linear-gradient(135deg, var(--primary), var(--accent)); width: 100%; padding: 14px; border: none; border-radius: 10px; color: white; font-weight: bold; font-size: 16px; margin-top: 10px; cursor: pointer; }
        
        /* BOTONES DE MODO ARREGLADOS */
        .mode-toggle { display: flex; background: var(--card); border-radius: 10px; padding: 4px; margin-bottom: 20px; border: 1px solid #334155; }
        .mode-btn { flex: 1; border: none; background: none; color: var(--muted); padding: 10px; font-weight: bold; font-size: 13px; cursor: pointer; border-radius: 8px; transition: 0.2s; }
        .mode-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        .profile-card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #334155; position: relative; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .clan-tag { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-size: 10px; color: var(--accent); border: 1px solid var(--accent); }
        .char-name { font-size: 22px; font-weight: 800; margin-bottom: 4px; }
        .char-job { color: var(--muted); font-size: 13px; display: block; margin-bottom: 12px; font-style: italic; }
        
        .level-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 6px; font-size: 12px; color: var(--muted); }
        .lvl-big { font-size: 26px; color: var(--gold); font-weight: bold; line-height: 1; }
        .xp-bar-bg { background: #0f172a; height: 10px; border-radius: 5px; overflow: hidden; border: 1px solid #334155; }
        .xp-bar-fill { background: linear-gradient(90deg, var(--gold), #fcd34d); height: 100%; width: 0%; transition: width 0.4s; }

        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .stat-box { background: #0f172a; padding: 12px 5px; border-radius: 10px; text-align: center; border: 1px solid #334155; }
        .s-val { font-size: 22px; font-weight: bold; display: block; line-height: 1.1; }
        .s-lbl { font-size: 9px; color: var(--muted); font-weight: bold; text-transform: uppercase; }
        .c-str { color: #ef4444; } .c-cha { color: #f472b6; } .c-int { color: #3b82f6; }

        .m-group { margin-bottom: 15px; }
        .m-head { font-size: 10px; color: var(--muted); font-weight: bold; text-transform: uppercase; border-bottom: 1px solid #334155; margin-bottom: 8px; padding-bottom: 4px; letter-spacing: 1px; }
        .m-btn { 
            background: var(--card); border: 1px solid #334155; padding: 14px; border-radius: 12px; 
            margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; 
            color: white; text-align: left; cursor: pointer; transition: 0.1s; position: relative; overflow: hidden;
        }
        .m-btn:active { transform: scale(0.98); background: #334155; border-color: var(--primary); }
        .m-info { flex: 1; margin-right: 10px; }
        .m-title { font-size: 14px; font-weight: 600; display: block; margin-bottom: 2px; }
        .m-desc { font-size: 11px; color: var(--muted); }
        .xp-badge { background: rgba(255,255,255,0.08); padding: 6px 10px; border-radius: 8px; font-size: 12px; color: var(--gold); font-weight: bold; min-width: 50px; text-align: center; }

        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--gold); color: black; padding: 10px 20px; border-radius: 30px; font-weight: bold; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 99; width: 80%; text-align: center; }
        .settings-link { display: block; text-align: center; color: #475569; font-size: 12px; text-decoration: underline; margin-top: 20px; cursor: pointer; padding: 10px; }
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        .modal { background: var(--card); padding: 25px; border-radius: 15px; width: 100%; max-width: 320px; text-align: center; border: 1px solid var(--danger); }
        #error-msg { display:none; color:white; background:#ef4444; padding:20px; position:fixed; top:0; left:0; width:100%; z-index:9999; text-align:center; }
    </style>
</head>
<body>

<div id="error-msg">Error. <button onclick="localStorage.clear();location.reload()">Reset</button></div>

<div class="container">
    <div class="lang-switch">
        <button class="lang-btn active" id="btn-es" onclick="setLang('es')">ES</button>
        <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
    </div>

    <div id="screen-create" class="screen">
        <h1 data-t="t_create">CREA TU PERFIL</h1>
        
        <div class="mode-toggle">
            <button class="mode-btn active" id="t-work" onclick="setMode('work')">üëî TRABAJO</button>
            <button class="mode-btn" id="t-study" onclick="setMode('study')">üéì ESTUDIO</button>
        </div>

        <label data-t="l_name">Nombre</label>
        <input type="text" id="inp-name" placeholder="...">
        
        <label data-t="l_clan">Clan</label>
        <select id="inp-clan"></select>

        <label id="lbl-job" data-t="l_job">Selecciona tu Profesi√≥n / Carrera</label>
        <select id="inp-job"></select>

        <button class="btn-main" onclick="startGame()" data-t="b_start">EMPEZAR</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="profile-card">
            <span class="clan-tag" id="ui-clan">Clan</span>
            <div class="char-name" id="ui-name">Name</div>
            <span class="char-job" id="ui-job">Job Title</span>
            <div class="level-row">
                <span data-t="l_lvl">Nivel Actual</span>
                <span class="lvl-big" id="ui-lvl">1</span>
            </div>
            <div class="xp-bar-bg"><div class="xp-bar-fill" id="ui-xp"></div></div>
            <div style="text-align:right; font-size:10px; color:#64748b; margin-top:4px" id="ui-xp-txt">0/1000</div>
        </div>

        <div class="stats">
            <div class="stat-box"><span class="s-val c-str" id="v-str">0</span><span class="s-lbl" data-t="s_str">FUERZA</span></div>
            <div class="stat-box"><span class="s-val c-cha" id="v-cha">0</span><span class="s-lbl" data-t="s_cha">CARISMA</span></div>
            <div class="stat-box"><span class="s-val c-int" id="v-int">0</span><span class="s-lbl" data-t="s_int">MENTE</span></div>
        </div>

        <div id="missions-area"></div>
        <div class="settings-link" onclick="openReset()" data-t="b_reset">Reiniciar / Reset</div>
    </div>
</div>

<div class="modal-bg" id="modal-reset">
    <div class="modal">
        <h3 style="color:var(--danger)" data-t="t_danger">‚ö†Ô∏è ZONA DE PELIGRO</h3>
        <p style="font-size:13px; color:#ccc" data-t="d_reset">Escribe tu nombre exacto:</p>
        <strong id="reset-hint" style="color:white; display:block; margin-bottom:10px">NAME</strong>
        <input type="text" id="inp-reset" style="text-align:center">
        <button class="btn-main" style="background:var(--danger)" onclick="confirmReset()" data-t="b_del">BORRAR</button>
        <button style="background:none; border:none; color:#888; text-decoration:underline; margin-top:10px" onclick="closeReset()">Cancelar</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* =========================================
   BASE DE DATOS MASIVA (ULTIMATE)
   ========================================= */

// LISTA DE MISIONES POR ROL (KEY)
const JOBS_DB = {
    // --- OFICIOS (TRADES) ---
    mechanic: { es: "Mec√°nico", en: "Mechanic", m: [{s:'str',xp:150,t:"Servicio R√°pido",d:"Cambio aceite/frenos"},{s:'int',xp:200,t:"Diagn√≥stico",d:"Hallar falla motor/el√©ctrica"},{s:'cha',xp:100,t:"Explicaci√≥n",d:"Explicar reparaci√≥n a cliente"}] },
    electric: { es: "Electricista", en: "Electrician", m: [{s:'str',xp:150,t:"Cableado Nuevo",d:"Instalar circuito"},{s:'int',xp:250,t:"Troubleshoot",d:"Rastrear corto"},{s:'int',xp:100,t:"Seguridad",d:"Testear tierra/fugas"}] },
    plumber: { es: "Plomero / Fontanero", en: "Plumber", m: [{s:'str',xp:200,t:"Instalaci√≥n",d:"Ba√±o/Cocina/Tuber√≠a"},{s:'str',xp:300,t:"Trabajo Sucio",d:"Destapar drenaje"},{s:'int',xp:150,t:"Detectar Fuga",d:"Hallar origen agua"}] },
    welder: { es: "Soldador", en: "Welder", m: [{s:'str',xp:200,t:"Uni√≥n Precisa",d:"Cord√≥n de soldadura limpio"},{s:'int',xp:150,t:"Lectura Plano",d:"Interpretar simbolog√≠a"},{s:'str',xp:100,t:"Esmerilado",d:"Limpiar/Pulir pieza"}] },
    carpenter: { es: "Carpintero", en: "Carpenter", m: [{s:'str',xp:200,t:"Construcci√≥n",d:"Estructura/Mueble"},{s:'int',xp:150,t:"Medida Exacta",d:"Corte sin error"},{s:'str',xp:100,t:"Lijado/Acabado",d:"Suavizar superficie"}] },
    hvac: { es: "T√©cnico HVAC", en: "HVAC Tech", m: [{s:'str',xp:200,t:"Instalar Unidad",d:"Montar A/C o Calefacci√≥n"},{s:'int',xp:200,t:"Carga Gas",d:"Medir presi√≥n refrigerante"},{s:'str',xp:150,t:"Espacio Confinado",d:"Trabajar en techo/√°tico"}] },
    mason: { es: "Alba√±il / Mas√≥n", en: "Mason / Bricklayer", m: [{s:'str',xp:250,t:"Muro/Pared",d:"Levantar hiladas niveladas"},{s:'str',xp:150,t:"Mezcla",d:"Preparar concreto/mortero"},{s:'int',xp:100,t:"Nivelaci√≥n",d:"Usar plomada/nivel"}] },
    painter: { es: "Pintor", en: "Painter", m: [{s:'str',xp:100,t:"Prep. Superficie",d:"Lijar/Tapar huecos"},{s:'str',xp:200,t:"Rodillo/Brocha",d:"Cubrir pared completa"},{s:'int',xp:100,t:"Corte/Detalle",d:"L√≠neas perfectas en bordes"}] },
    landscaper: { es: "Jardinero / Landscaper", en: "Landscaper", m: [{s:'str',xp:200,t:"Mantenimiento",d:"Podar/Cortar c√©sped"},{s:'str',xp:300,t:"Instalaci√≥n",d:"Plantar √°rbol/Poner pasto"},{s:'int',xp:100,t:"Sistema Riego",d:"Reparar aspersor"}] },
    pw: { es: "Lavado a Presi√≥n", en: "Pressure Washer", m: [{s:'str',xp:150,t:"Lavado Casa",d:"Limpiar siding/pared"},{s:'str',xp:200,t:"Concreto",d:"Limpiar driveway/acera"},{s:'int',xp:100,t:"Mezcla Qu√≠micos",d:"Ratio correcto SH/Agua"}] },
    pest: { es: "Control de Plagas", en: "Pest Control", m: [{s:'int',xp:150,t:"Inspecci√≥n",d:"Hallar nido/entrada"},{s:'str',xp:150,t:"Aplicaci√≥n",d:"Rociar per√≠metro"},{s:'cha',xp:100,t:"Reporte Cliente",d:"Explicar prevenci√≥n"}] },
    locksmith: { es: "Cerrajero", en: "Locksmith", m: [{s:'int',xp:200,t:"Apertura",d:"Abrir puerta cerrada"},{s:'int',xp:100,t:"Corte Llave",d:"Duplicado preciso"},{s:'str',xp:150,t:"Instalaci√≥n",d:"Montar cerradura nueva"}] },
    roofer: { es: "Techador (Roofer)", en: "Roofer", m: [{s:'str',xp:300,t:"Instalar Tejas",d:"Clavar shingles/laminas"},{s:'str',xp:150,t:"Tear Off",d:"Arrancar techo viejo"},{s:'int',xp:150,t:"Impermeabilizar",d:"Sellar uniones/flashings"}] },
    solar: { es: "Instalador Solar", en: "Solar Installer", m: [{s:'str',xp:200,t:"Montaje Paneles",d:"Fijar rieles y paneles"},{s:'int',xp:200,t:"Conexi√≥n El√©ctrica",d:"Inversor y tablero"},{s:'str',xp:150,t:"Trabajo Altura",d:"Seguridad en techo"}] },

    // --- SERVICIO / HOSPITALITY ---
    chef: { es: "Chef / Cocinero", en: "Chef / Cook", m: [{s:'str',xp:200,t:"Servicio (Rush)",d:"Hora pico sin errores"},{s:'str',xp:100,t:"Mise en place",d:"Picar y organizar todo"},{s:'int',xp:150,t:"Receta Nueva",d:"Crear o probar plato"}] },
    bartender: { es: "Bartender", en: "Bartender", m: [{s:'str',xp:150,t:"Cocktail Rush",d:"5 tragos en 5 mins"},{s:'cha',xp:200,t:"Atenci√≥n Barra",d:"Conversar y servir"},{s:'int',xp:100,t:"Inventario",d:"Contar botellas/stock"}] },
    barista: { es: "Barista", en: "Barista", m: [{s:'int',xp:100,t:"Calibrar Molino",d:"Espresso perfecto"},{s:'str',xp:150,t:"Rush Ma√±ana",d:"Cola de clientes r√°pida"},{s:'cha',xp:100,t:"Latte Art",d:"Dibujo en caf√©"}] },
    server: { es: "Mesero / Server", en: "Waiter / Server", m: [{s:'str',xp:150,t:"Bandeja Pesada",d:"Llevar 3+ platos"},{s:'cha',xp:200,t:"Upselling",d:"Vender postre/vino"},{s:'int',xp:100,t:"Memorizar Orden",d:"Sin anotar (3 personas)"}] },
    frontdesk: { es: "Recepcionista Hotel", en: "Front Desk", m: [{s:'cha',xp:150,t:"Check-in R√°pido",d:"Procesar llegada grupo"},{s:'cha',xp:200,t:"Queja Hu√©sped",d:"Calmar cliente enojado"},{s:'int',xp:100,t:"Reservas",d:"Organizar asignaciones"}] },
    flightatt: { es: "Azafata / Tripulante", en: "Flight Attendant", m: [{s:'cha',xp:150,t:"Servicio Bordo",d:"Atender pasajeros"},{s:'int',xp:200,t:"Seguridad",d:"Chequeo pre-vuelo"},{s:'str',xp:100,t:"Emergencia",d:"Simulacro o gesti√≥n real"}] },
    eventplan: { es: "Event Planner", en: "Event Planner", m: [{s:'int',xp:200,t:"Log√≠stica",d:"Coordinar proveedores"},{s:'cha',xp:150,t:"Cliente Nervioso",d:"Calmar a los novios/jefe"},{s:'str',xp:150,t:"Montaje",d:"Supervisar decoraci√≥n"}] },

    // --- SALUD ---
    doctor: { es: "M√©dico / Doctor", en: "Doctor / Physician", m: [{s:'int',xp:250,t:"Diagn√≥stico",d:"Interpretar s√≠ntomas/labs"},{s:'cha',xp:150,t:"Comunicaci√≥n",d:"Dar noticias a paciente"},{s:'str',xp:200,t:"Guardia",d:"Turno largo hospital"}] },
    nurse: { es: "Enfermero/a", en: "Nurse", m: [{s:'str',xp:150,t:"Ronda Pacientes",d:"Chequear vitales/meds"},{s:'str',xp:150,t:"V√≠a/Extracci√≥n",d:"Poner suero o sacar sangre"},{s:'cha',xp:200,t:"Cuidado",d:"Confortar paciente"}] },
    emt: { es: "Param√©dico / EMT", en: "EMT / Paramedic", m: [{s:'str',xp:250,t:"Respuesta R√°pida",d:"Llegar a escena y actuar"},{s:'str',xp:200,t:"Cargar Paciente",d:"Mover camilla/persona"},{s:'int',xp:150,t:"Estabilizar",d:"Primeros auxilios vitales"}] },
    dentist: { es: "Dentista", en: "Dentist", m: [{s:'str',xp:150,t:"Procedimiento",d:"Empaste/Extracci√≥n"},{s:'int',xp:150,t:"Precisi√≥n",d:"Trabajo fino en diente"},{s:'cha',xp:100,t:"Calmar Miedo",d:"Relajar al paciente"}] },
    vet: { es: "Veterinario", en: "Veterinarian", m: [{s:'int',xp:200,t:"Diagn√≥stico Animal",d:"Sin que el paciente hable"},{s:'str',xp:150,t:"Cirug√≠a",d:"Esterilizaci√≥n/Herida"},{s:'cha',xp:100,t:"Due√±o Preocupado",d:"Explicar tratamiento"}] },
    pharm: { es: "Farmac√©utico", en: "Pharmacist", m: [{s:'int',xp:150,t:"Verificar Receta",d:"Chequear interacci√≥n drogas"},{s:'cha',xp:100,t:"Consejo",d:"Explicar uso medicinas"},{s:'int',xp:100,t:"Inventario",d:"Control de stock"}] },
    pt: { es: "Fisioterapeuta", en: "Physical Therapist", m: [{s:'str',xp:150,t:"Terapia Manual",d:"Masaje/Movilizaci√≥n"},{s:'cha',xp:150,t:"Motivar",d:"Empujar al paciente"},{s:'int',xp:100,t:"Plan Ejercicio",d:"Dise√±ar rutina recuperaci√≥n"}] },
    trainer: { es: "Entrenador Personal", en: "Personal Trainer", m: [{s:'str',xp:150,t:"Dar Clase",d:"Sesi√≥n intensa 1:1"},{s:'cha',xp:150,t:"Corregir T√©cnica",d:"Ajustar postura cliente"},{s:'int',xp:100,t:"Planificaci√≥n",d:"Crear mesociclo"}] },

    // --- TRANSPORTE / SEGURIDAD ---
    trucker: { es: "Camionero / Trucker", en: "Truck Driver", m: [{s:'str',xp:200,t:"Ruta Larga",d:"8h+ conducci√≥n"},{s:'int',xp:100,t:"Logbook",d:"Registrar horas/carga"},{s:'str',xp:100,t:"Inspecci√≥n",d:"Revisar frenos/ruedas"}] },
    delivery: { es: "Delivery / Repartidor", en: "Delivery Driver", m: [{s:'str',xp:150,t:"Ruta R√°pida",d:"10 entregas en 1h"},{s:'str',xp:100,t:"Carga/Descarga",d:"Paquetes pesados"},{s:'cha',xp:50,t:"Trato Cliente",d:"Entrega con sonrisa"}] },
    pilot: { es: "Piloto", en: "Pilot", m: [{s:'int',xp:250,t:"Vuelo Seguro",d:"Despegue a Aterrizaje"},{s:'int',xp:150,t:"Checklist",d:"Pre-vuelo completo"},{s:'cha',xp:100,t:"Comunicaci√≥n",d:"Hablar con torre/pasajeros"}] },
    police: { es: "Polic√≠a", en: "Police Officer", m: [{s:'str',xp:150,t:"Patrullaje",d:"Ronda de vigilancia"},{s:'int',xp:150,t:"Reporte",d:"Documentar incidente"},{s:'cha',xp:200,t:"Desescalar",d:"Calmar situaci√≥n tensa"}] },
    fire: { es: "Bombero", en: "Firefighter", m: [{s:'str',xp:300,t:"Emergencia",d:"Incendio/Rescate activo"},{s:'str',xp:150,t:"Entreno F√≠sico",d:"Mantener condici√≥n"},{s:'int',xp:100,t:"Mantenimiento",d:"Limpiar cami√≥n/equipo"}] },
    security: { es: "Guardia Seguridad", en: "Security Guard", m: [{s:'str',xp:100,t:"Ronda",d:"Caminar per√≠metro"},{s:'int',xp:100,t:"Monitoreo",d:"Observar c√°maras"},{s:'cha',xp:100,t:"Control Acceso",d:"Verificar IDs"}] },
    military: { es: "Militar", en: "Military", m: [{s:'str',xp:200,t:"PT / F√≠sico",d:"Entrenamiento duro"},{s:'int',xp:150,t:"Mantenimiento",d:"Limpiar arma/equipo"},{s:'str',xp:150,t:"Maniobras",d:"Ejercicio de campo"}] },

    // --- CORPORATIVO ---
    lawyer: { es: "Abogado", en: "Lawyer", m: [{s:'int',xp:200,t:"Redacci√≥n",d:"Contrato/Demanda"},{s:'int',xp:150,t:"Investigaci√≥n",d:"Buscar leyes/casos"},{s:'cha',xp:200,t:"Negociaci√≥n",d:"Acuerdo favorable"}] },
    accountant: { es: "Contador", en: "Accountant", m: [{s:'int',xp:200,t:"Cierre Mes",d:"Conciliar bancos"},{s:'int',xp:150,t:"Impuestos",d:"Calcular declaraci√≥n"},{s:'int',xp:100,t:"Auditor√≠a",d:"Revisar errores"}] },
    hr: { es: "RRHH / Recruiter", en: "HR / Recruiter", m: [{s:'cha',xp:150,t:"Entrevista",d:"Evaluar candidato"},{s:'int',xp:100,t:"Admin",d:"Contratos/N√≥mina"},{s:'cha',xp:200,t:"Resoluci√≥n",d:"Mediar conflicto empleados"}] },
    pm: { es: "Project Manager", en: "Project Manager", m: [{s:'cha',xp:150,t:"Reuni√≥n Equipo",d:"Sincronizar tareas"},{s:'int',xp:200,t:"Planificaci√≥n",d:"Ajustar cronograma/presupuesto"},{s:'cha',xp:100,t:"Stakeholders",d:"Reportar a directivos"}] },
    adminasst: { es: "Asistente Admin", en: "Admin Assistant", m: [{s:'int',xp:100,t:"Inbox Zero",d:"Limpiar emails"},{s:'cha',xp:150,t:"Agenda",d:"Coordinar reuniones"},{s:'int',xp:100,t:"Documentos",d:"Organizar archivos"}] },
    realestate: { es: "Real Estate (Ventas)", en: "Real Estate Agent", m: [{s:'str',xp:150,t:"Open House",d:"Mostrar propiedad"},{s:'cha',xp:100,t:"Llamadas",d:"Contactar leads"},{s:'cha',xp:500,t:"CIERRE",d:"Firmar escritura"}] },
    sales_ret: { es: "Ventas (Retail)", en: "Retail Sales", m: [{s:'cha',xp:150,t:"Atenci√≥n",d:"Ayudar cliente piso"},{s:'str',xp:100,t:"Stock",d:"Reponer estantes"},{s:'int',xp:100,t:"Caja",d:"Cobrar/Cierre"}] },
    consultant: { es: "Consultor", en: "Consultant", m: [{s:'int',xp:200,t:"An√°lisis",d:"Evaluar datos cliente"},{s:'cha',xp:200,t:"Presentaci√≥n",d:"Exponer soluci√≥n"},{s:'int',xp:150,t:"Slide Deck",d:"Hacer PowerPoint"}] },

    // --- TECH / CREATIVO ---
    dev: { es: "Programador", en: "Developer", m: [{s:'str',xp:100,t:"Deep Work",d:"1h c√≥digo puro"},{s:'int',xp:150,t:"Debug",d:"Arreglar bug"},{s:'str',xp:300,t:"Deploy",d:"Subir a producci√≥n"}] },
    designer: { es: "Dise√±ador Gr√°fico", en: "Graphic Designer", m: [{s:'int',xp:150,t:"Dise√±ar",d:"Crear bocetos/logos"},{s:'cha',xp:100,t:"Feedback",d:"Revisi√≥n con cliente"},{s:'int',xp:100,t:"Exportar",d:"Archivos finales listos"}] },
    photo: { es: "Fot√≥grafo", en: "Photographer", m: [{s:'str',xp:200,t:"Sesi√≥n Fotos",d:"Shooting activo"},{s:'int',xp:150,t:"Edici√≥n",d:"Lightroom/Photoshop"},{s:'cha',xp:100,t:"Direcci√≥n",d:"Guiar modelo/cliente"}] },
    video: { es: "Vide√≥grafo / Editor", en: "Videographer", m: [{s:'str',xp:200,t:"Grabaci√≥n",d:"Rodaje con equipo"},{s:'int',xp:200,t:"Edici√≥n",d:"Cortar/Color/Sonido"},{s:'int',xp:100,t:"Render",d:"Exportar video final"}] },
    architect: { es: "Arquitecto", en: "Architect", m: [{s:'int',xp:200,t:"Dise√±o Plano",d:"CAD/Revit"},{s:'str',xp:150,t:"Visita Obra",d:"Supervisar construcci√≥n"},{s:'cha',xp:100,t:"Cliente",d:"Presentar maqueta/render"}] },
    musician: { es: "M√∫sico", en: "Musician", m: [{s:'str',xp:150,t:"Pr√°ctica",d:"Instrumento/Voz"},{s:'cha',xp:200,t:"Show/Gig",d:"Actuaci√≥n en vivo"},{s:'int',xp:150,t:"Componer",d:"Escribir m√∫sica/letra"}] },
    tattoo: { es: "Tatuador", en: "Tattoo Artist", m: [{s:'str',xp:250,t:"Tatuar",d:"Sesi√≥n larga aguja"},{s:'int',xp:100,t:"Dise√±o",d:"Dibujar stencil"},{s:'int',xp:100,t:"Higiene",d:"Esterilizar todo"}] },

    // --- ESTUDIANTES ---
    stu_hs: { es: "Estudiante Secundaria", en: "High School Student", m: [{s:'str',xp:100,t:"Tarea",d:"A tiempo"},{s:'int',xp:200,t:"Examen",d:"Estudiar y aprobar"},{s:'str',xp:150,t:"Deporte",d:"Clase EF o Club"}] },
    stu_med: { es: "Estudiante Medicina", en: "Med Student", m: [{s:'int',xp:150,t:"Anki/Flashcards",d:"50 tarjetas"},{s:'str',xp:200,t:"Rotaci√≥n",d:"Pr√°ctica hospital"},{s:'int',xp:250,t:"Parcial",d:"Aprobar examen masivo"}] },
    stu_law: { es: "Estudiante Derecho", en: "Law Student", m: [{s:'int',xp:200,t:"Leer Casos",d:"Lectura densa"},{s:'cha',xp:150,t:"Debate",d:"Argumentar en clase"},{s:'int',xp:100,t:"Memorizar",d:"Leyes/Art√≠culos"}] },
    stu_eng: { es: "Estudiante Ingenier√≠a", en: "Engineering Student", m: [{s:'int',xp:150,t:"Ejercicios",d:"Resolver problemas"},{s:'str',xp:200,t:"Proyecto/Lab",d:"Construir/Probar"},{s:'int',xp:200,t:"C√°lculo",d:"Estudiar mate avanzada"}] },
    stu_arts: { es: "Estudiante Artes/Humanidades", en: "Arts Student", m: [{s:'str',xp:200,t:"Ensayo/Paper",d:"Escribir largo"},{s:'int',xp:150,t:"Lectura",d:"Leer libros completos"},{s:'cha',xp:100,t:"Clase/Seminario",d:"Participar"}] },
    stu_biz: { es: "Estudiante Negocios", en: "Business Student", m: [{s:'cha',xp:150,t:"Presentaci√≥n",d:"Exponer proyecto"},{s:'int',xp:150,t:"Caso Estudio",d:"Analizar empresa"},{s:'cha',xp:100,t:"Networking",d:"Evento uni"}] },
    stu_sci: { es: "Estudiante Ciencias", en: "Science Student", m: [{s:'str',xp:200,t:"Laboratorio",d:"Experimento"},{s:'int',xp:150,t:"Reporte",d:"Escribir hallazgos"},{s:'int',xp:150,t:"Teor√≠a",d:"Estudiar conceptos"}] }
};

// CATEGORIAS PARA EL SELECT (TRABAJO vs ESTUDIO)
const GROUPS = {
    // WORK
    "üõ†Ô∏è OFICIOS": ["mechanic","electric","plumber","welder","carpenter","hvac","mason","painter","landscaper","pw","pest","locksmith","roofer","solar"],
    "ü§ù SERVICIO": ["chef","bartender","barista","server","frontdesk","flightatt","eventplan"],
    "üè• SALUD": ["doctor","nurse","emt","dentist","vet","pharm","pt","trainer"],
    "üöö TRANSPORTE/SEG": ["trucker","delivery","pilot","police","fire","security","military"],
    "üíº CORPORATIVO": ["lawyer","accountant","hr","pm","adminasst","realestate","sales_ret","consultant"],
    "üé® TECH / CREATIVO": ["dev","designer","photo","video","architect","musician","tattoo"],
    // STUDY
    "üéì ESTUDIANTES": ["stu_hs","stu_med","stu_law","stu_eng","stu_arts","stu_biz","stu_sci"]
};

/* --- TEXTOS UI --- */
const T = {
    es: { t_create:"CREA TU PERFIL", l_name:"Nombre", l_clan:"Clan", l_job:"Profesi√≥n", b_start:"EMPEZAR", l_lvl:"Nivel", s_str:"FUERZA", s_cha:"CARISMA", s_int:"MENTE", b_reset:"Reiniciar", t_danger:"ZONA DE PELIGRO", d_reset:"Escribe tu nombre para borrar:", b_del:"BORRAR", clans:["ü¶Å Leones (Liderazgo)","ü¶ä Zorros (Astucia)","üîÆ Magos (Creatividad)","üêç Serpientes (Ambici√≥n)","üêê Cabras (Persistencia)"] },
    en: { t_create:"CREATE PROFILE", l_name:"Name", l_clan:"Clan", l_job:"Profession", b_start:"START", l_lvl:"Level", s_str:"STRENGTH", s_cha:"CHARISMA", s_int:"MIND", b_reset:"Reset", t_danger:"DANGER ZONE", d_reset:"Type name to delete:", b_del:"DELETE", clans:["ü¶Å Lions (Leadership)","ü¶ä Foxes (Cunning)","üîÆ Mages (Creativity)","üêç Serpents (Ambition)","üêê Goats (Persistence)"] }
};

let lang = 'es', mode = 'work', player = { name:"", clan:"", jobKey:"", lvl:1, xp:0, next:1000, stats:{str:0, cha:0, int:0} };

window.onload = () => {
    try {
        lang = localStorage.getItem('rpg_lang') || 'es';
        setLang(lang, false);
        
        const clanSel = document.getElementById('inp-clan');
        clanSel.innerHTML = "";
        T[lang].clans.forEach((c, i) => { let o = document.createElement('option'); o.value = i; o.innerText = c; clanSel.appendChild(o); });

        // INICIALIZAR MODO
        setMode('work'); 

        const save = localStorage.getItem('rpg_save_fixed');
        if(save) {
            player = JSON.parse(save);
            if(!player.stats) player.stats = {str:0, cha:0, int:0};
            initGame();
        } else {
            document.getElementById('screen-create').classList.add('active');
        }
    } catch(e) { document.getElementById('error-msg').style.display='block'; }
};

function setMode(m) {
    mode = m;
    // Update Button Styles
    document.getElementById('t-work').className = m === 'work' ? 'mode-btn active' : 'mode-btn';
    document.getElementById('t-study').className = m === 'study' ? 'mode-btn active' : 'mode-btn';

    // Populate List based on Mode
    const jobSel = document.getElementById('inp-job');
    jobSel.innerHTML = "";
    
    for (const [groupName, keys] of Object.entries(GROUPS)) {
        // FILTRO: Si es Study, solo mostrar grupo estudiantes. Si es Work, mostrar todo menos estudiantes.
        const isStudentGroup = groupName === "üéì ESTUDIANTES";
        if ((m === 'study' && isStudentGroup) || (m === 'work' && !isStudentGroup)) {
            const grp = document.createElement('optgroup');
            grp.label = groupName;
            keys.forEach(k => {
                const opt = document.createElement('option');
                opt.value = k;
                opt.innerText = JOBS_DB[k][lang];
                grp.appendChild(opt);
            });
            jobSel.appendChild(grp);
        }
    }
}

function setLang(l, r=true) {
    lang = l; localStorage.setItem('rpg_lang', l);
    document.getElementById('btn-es').classList.toggle('active', l==='es');
    document.getElementById('btn-en').classList.toggle('active', l==='en');
    document.querySelectorAll('[data-t]').forEach(e => { if(T[l][e.dataset.t]) e.innerText = T[l][e.dataset.t]; });
    if(r) location.reload();
}

function startGame() {
    const n = document.getElementById('inp-name').value;
    if(!n) return alert("Name required");
    player.name = n;
    player.clan = T[lang].clans[document.getElementById('inp-clan').value];
    player.jobKey = document.getElementById('inp-job').value;
    save(); initGame();
}

function initGame() {
    document.getElementById('screen-create').classList.remove('active');
    document.getElementById('screen-game').classList.add('active');
    renderUI();
}

function renderUI() {
    document.getElementById('ui-name').innerText = player.name;
    const jobData = JOBS_DB[player.jobKey];
    document.getElementById('ui-job').innerText = jobData ? jobData[lang] : "Unknown";
    document.getElementById('ui-clan').innerText = player.clan.split(' ')[0]+" "+player.clan.split(' ')[1];
    document.getElementById('ui-lvl').innerText = player.lvl;
    document.getElementById('v-str').innerText = player.stats.str;
    document.getElementById('v-cha').innerText = player.stats.cha;
    document.getElementById('v-int').innerText = player.stats.int;
    const pct = (player.xp / player.next)*100;
    document.getElementById('ui-xp').style.width = pct+"%";
    document.getElementById('ui-xp-txt').innerText = Math.floor(player.xp)+"/"+player.next;
    document.getElementById('reset-hint').innerText = player.name;
    renderMissions();
}

function renderMissions() {
    const area = document.getElementById('missions-area');
    area.innerHTML = "";
    const missions = JOBS_DB[player.jobKey] ? JOBS_DB[player.jobKey].m : [];

    ['str', 'cha', 'int'].forEach(stat => {
        const ms = missions.filter(m => m.s === stat);
        if(ms.length > 0) {
            const grp = document.createElement('div'); grp.className='m-group';
            const h = document.createElement('div'); h.className='m-head'; h.innerText=T[lang]['s_'+stat]; grp.appendChild(h);
            ms.forEach(m => {
                const b = document.createElement('div'); b.className='m-btn'; b.onclick=()=>gain(m.xp, m.s);
                // Detectar idioma de la misi√≥n
                const title = m.t_es ? (lang==='es'?m.t_es:m.t_en) : m.t;
                const desc = m.d_es ? (lang==='es'?m.d_es:m.d_en) : m.d;
                b.innerHTML = `<div class="m-info"><span class="m-title">${title}</span><span class="m-desc">${desc}</span></div><div class="xp-badge">+${m.xp}</div>`;
                grp.appendChild(b);
            });
            area.appendChild(grp);
        }
    });
}

function gain(xp, s) {
    player.xp+=xp; player.stats[s]++;
    let m = `+${xp} XP`;
    if(player.xp >= player.next) { player.lvl++; player.xp-=player.next; player.next=Math.floor(player.next*1.2); m="üéâ LEVEL UP!"; }
    save(); renderUI(); toast(m);
}

function toast(m) {
    const t = document.getElementById('toast'); t.innerText=m; t.style.opacity=1; t.style.bottom="40px";
    setTimeout(()=>{t.style.opacity=0;t.style.bottom="30px"}, 2000);
}

function save() { localStorage.setItem('rpg_save_fixed', JSON.stringify(player)); }
function openReset() { document.getElementById('modal-reset').style.display='flex'; }
function closeReset() { document.getElementById('modal-reset').style.display='none'; }
function confirmReset() {
    if(document.getElementById('inp-reset').value === player.name) { localStorage.removeItem('rpg_save_fixed'); location.reload(); }
}
</script>
</body>
</html>
