<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG Life: Stable Edition</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #3b82f6; --accent: #8b5cf6; --gold: #f59e0b; --danger: #ef4444; --text: #f8fafc; --muted: #94a3b8; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 420px; position: relative; }
        
        /* Language & UI */
        .lang-switch { position: absolute; top: -35px; right: 0; display: flex; gap: 5px; }
        .lang-btn { background: var(--card); border: 1px solid #334155; color: var(--muted); padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; cursor: pointer; }
        .lang-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .screen { display: none; animation: fade 0.4s; }
        .active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h1, h2 { text-align: center; color: var(--primary); margin: 0 0 15px 0; }
        label { display: block; color: var(--muted); font-size: 11px; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
        input, select { width: 100%; padding: 12px; background: var(--card); border: 2px solid #334155; color: white; border-radius: 8px; font-size: 16px; margin-bottom: 15px; box-sizing: border-box; outline: none; }
        input:focus, select:focus { border-color: var(--primary); }
        
        .btn-main { background: linear-gradient(135deg, var(--primary), var(--accent)); width: 100%; padding: 14px; border: none; border-radius: 10px; color: white; font-weight: bold; font-size: 16px; margin-top: 10px; cursor: pointer; }

        /* MODE TOGGLE */
        .mode-toggle { display: flex; background: var(--card); border-radius: 10px; padding: 4px; margin-bottom: 20px; border: 1px solid #334155; }
        .mode-btn { flex: 1; border: none; background: none; color: var(--muted); padding: 10px; font-weight: bold; font-size: 13px; cursor: pointer; border-radius: 8px; transition: 0.2s; }
        .mode-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* Profile */
        .profile-card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #334155; position: relative; margin-bottom: 20px; }
        .clan-tag { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-size: 10px; color: var(--accent); border: 1px solid var(--accent); }
        .char-name { font-size: 22px; font-weight: 800; margin-bottom: 5px; }
        .char-job { color: var(--muted); font-size: 13px; display: block; margin-bottom: 10px; }
        
        .level-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 5px; font-size: 12px; color: var(--muted); }
        .lvl-big { font-size: 24px; color: var(--gold); font-weight: bold; line-height: 1; }
        .xp-bar-bg { background: #0f172a; height: 8px; border-radius: 4px; overflow: hidden; }
        .xp-bar-fill { background: var(--gold); height: 100%; width: 0%; transition: width 0.3s; }

        /* Stats */
        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .stat-box { background: #0f172a; padding: 10px; border-radius: 8px; text-align: center; border: 1px solid #334155; }
        .s-val { font-size: 20px; font-weight: bold; display: block; }
        .s-lbl { font-size: 9px; color: var(--muted); font-weight: bold; text-transform: uppercase; }
        .c-str { color: #ef4444; } .c-cha { color: #f472b6; } .c-int { color: #3b82f6; }

        /* Missions */
        .m-group { margin-bottom: 15px; }
        .m-head { font-size: 10px; color: var(--muted); font-weight: bold; text-transform: uppercase; border-bottom: 1px solid #334155; margin-bottom: 8px; padding-bottom: 2px; }
        .m-btn { 
            background: var(--card); border: 1px solid #334155; padding: 12px; border-radius: 10px; 
            margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; 
            color: white; text-align: left; cursor: pointer; transition: 0.1s;
        }
        .m-btn:active { transform: scale(0.98); background: #334155; border-color: var(--primary); }
        .m-info { flex: 1; margin-right: 10px; }
        .m-title { font-size: 14px; font-weight: 600; display: block; }
        .m-desc { font-size: 11px; color: var(--muted); font-style: italic; }
        .xp-badge { background: rgba(255,255,255,0.05); padding: 5px 8px; border-radius: 6px; font-size: 11px; color: var(--gold); font-weight: bold; min-width: 45px; text-align: center; }

        /* Toast & Modal */
        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--gold); color: black; padding: 8px 16px; border-radius: 20px; font-weight: bold; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 99; width: 80%; text-align: center; }
        .settings-link { display: block; text-align: center; color: #475569; font-size: 12px; text-decoration: underline; margin-top: 20px; cursor: pointer; }
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        .modal { background: var(--card); padding: 25px; border-radius: 15px; width: 100%; max-width: 320px; text-align: center; border: 1px solid var(--danger); }
        
        #error-msg { display:none; color:red; text-align:center; padding:20px; background:white; position:fixed; top:0; left:0; width:100%; z-index:9999; }
    </style>
</head>
<body>

<div id="error-msg">
    <h2>Algo sali√≥ mal üòî</h2>
    <p>Hubo un error cargando tus datos.</p>
    <button onclick="localStorage.clear(); location.reload()">üö® CLIC PARA REPARAR (BORRAR DATOS)</button>
</div>

<div class="container">
    <div class="lang-switch">
        <button class="lang-btn active" id="btn-es" onclick="setLang('es')">ES</button>
        <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
    </div>

    <div id="screen-create" class="screen">
        <h1 data-t="t_create">CREA TU PERFIL</h1>
        
        <div class="mode-toggle">
            <button class="mode-btn active" id="t-work" onclick="setMode('work')">üëî TRABAJO</button>
            <button class="mode-btn" id="t-study" onclick="setMode('study')">üéì ESTUDIO</button>
        </div>

        <label data-t="l_name">Nombre</label>
        <input type="text" id="inp-name" placeholder="...">
        
        <label data-t="l_clan">Clan</label>
        <select id="inp-clan"></select>

        <label id="lbl-cat" data-t="l_cat">Industria</label>
        <select id="inp-category" onchange="updateSubSelect()"></select>

        <label id="lbl-job" data-t="l_job">Especialidad</label>
        <select id="inp-job"></select>

        <button class="btn-main" onclick="startGame()" data-t="b_start">EMPEZAR</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="profile-card">
            <span class="clan-tag" id="ui-clan">Clan</span>
            <div class="char-name" id="ui-name">Name</div>
            <span class="char-job" id="ui-job">Job Title</span>
            <div class="level-row">
                <span data-t="l_lvl">Nivel Actual</span>
                <span class="lvl-big" id="ui-lvl">1</span>
            </div>
            <div class="xp-bar-bg"><div class="xp-bar-fill" id="ui-xp"></div></div>
            <div style="text-align:right; font-size:10px; color:#64748b; margin-top:4px" id="ui-xp-txt">0/1000</div>
        </div>

        <div class="stats">
            <div class="stat-box"><span class="s-val c-str" id="v-str">0</span><span class="s-lbl" data-t="s_str">FUERZA</span></div>
            <div class="stat-box"><span class="s-val c-cha" id="v-cha">0</span><span class="s-lbl" data-t="s_cha">CARISMA</span></div>
            <div class="stat-box"><span class="s-val c-int" id="v-int">0</span><span class="s-lbl" data-t="s_int">MENTE</span></div>
        </div>

        <div id="missions-area"></div>
        <div class="settings-link" onclick="openReset()" data-t="b_reset">Reiniciar / Reset</div>
    </div>
</div>

<div class="modal-bg" id="modal-reset">
    <div class="modal">
        <h3 style="color:var(--danger)" data-t="t_danger">‚ö†Ô∏è ZONA DE PELIGRO</h3>
        <p style="font-size:13px; color:#ccc" data-t="d_reset">Escribe tu nombre exacto:</p>
        <strong id="reset-hint" style="color:white; display:block; margin-bottom:10px">NAME</strong>
        <input type="text" id="inp-reset" style="text-align:center">
        <button class="btn-main" style="background:var(--danger)" onclick="confirmReset()" data-t="b_del">BORRAR</button>
        <button style="background:none; border:none; color:#888; text-decoration:underline; margin-top:10px" onclick="closeReset()">Cancelar</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
// --- CONTROL DE ERRORES ---
window.onerror = function() {
    document.getElementById('error-msg').style.display = 'block';
};

/* --- BASE DE DATOS --- */
const DB = {
    // TRABAJO
    cat_trades: {
        type: 'work', es: "Oficios / Manual", en: "Trades / Manual",
        jobs: {
            pressure: {
                es: "Lavado a Presi√≥n", en: "Pressure Washing",
                m: [
                    {s:'str', xp:100, t_es:"Prep. M√°quina", d_es:"Mezclar qu√≠micos / Aceite", t_en:"Prep Machine", d_en:"Mix chems / Oil"},
                    {s:'str', xp:300, t_es:"Trabajo Completo", d_es:"Lavar casa entera", t_en:"Full Job", d_en:"Wash full house"},
                    {s:'cha', xp:150, t_es:"Foto Antes/Despu√©s", d_es:"Enviar al cliente", t_en:"Before/After Pic", d_en:"Send to client"},
                    {s:'int', xp:250, t_es:"Cotizar Plano", d_es:"Medir pies cuadrados sat√©lite", t_en:"Quote Map", d_en:"Measure sqft satellite"}
                ]
            },
            hvac: {
                es: "HVAC / Plomer√≠a", en: "HVAC / Plumbing",
                m: [
                    {s:'str', xp:120, t_es:"Instalaci√≥n", d_es:"Montar unidad", t_en:"Install", d_en:"Mount unit"},
                    {s:'int', xp:200, t_es:"Diagn√≥stico", d_es:"Encontrar falla el√©ctrica", t_en:"Diagnosis", d_en:"Find elec fault"}
                ]
            },
            general_trade: {
                es: "Contratista General", en: "General Contractor",
                m: [
                    {s:'str', xp:150, t_es:"D√≠a de Obra", d_es:"8 horas de labor", t_en:"Site Day", d_en:"8 hours labor"},
                    {s:'cha', xp:200, t_es:"Cliente Feliz", d_es:"Aprobaci√≥n final de obra", t_en:"Happy Client", d_en:"Final sign-off"}
                ]
            }
        }
    },
    cat_tech: {
        type: 'work', es: "Tecnolog√≠a", en: "Technology",
        jobs: {
            dev: {
                es: "Programador", en: "Developer",
                m: [
                    {s:'str', xp:100, t_es:"Deep Work", d_es:"1h c√≥digo puro", t_en:"Deep Work", d_en:"1h pure code"},
                    {s:'int', xp:150, t_es:"Debuguear", d_es:"Arreglar bug dif√≠cil", t_en:"Debug", d_en:"Fix tough bug"},
                    {s:'str', xp:300, t_es:"Deploy", d_es:"Subir a producci√≥n", t_en:"Deploy", d_en:"Push to prod"}
                ]
            }
        }
    },
    cat_sales: {
        type: 'work', es: "Ventas / Retail", en: "Sales",
        jobs: {
            realtor: {
                es: "Bienes Ra√≠ces", en: "Real Estate",
                m: [
                    {s:'str', xp:200, t_es:"Open House", d_es:"Mostrar casa 2h", t_en:"Open House", d_en:"Show home 2h"},
                    {s:'cha', xp:100, t_es:"Llamadas Fr√≠as", d_es:"10 prospectos", t_en:"Cold Calls", d_en:"10 leads"},
                    {s:'cha', xp:500, t_es:"CERRAR TRATO", d_es:"Firmar contrato", t_en:"CLOSE DEAL", d_en:"Sign contract"}
                ]
            }
        }
    },
    // ESTUDIO
    stu_hs: {
        type: 'study', es: "Escuela / Secundaria", en: "High School",
        jobs: {
            general_hs: {
                es: "Estudiante", en: "Student",
                m: [
                    {s:'str', xp:100, t_es:"Tarea Completa", d_es:"A tiempo y bien hecha", t_en:"Homework Done", d_en:"On time & good"},
                    {s:'str', xp:150, t_es:"Deporte/Gym", d_es:"1h actividad f√≠sica", t_en:"Sports/Gym", d_en:"1h physical activity"},
                    {s:'int', xp:300, t_es:"Aprobar Examen", d_es:"Nota alta en prueba", t_en:"Pass Exam", d_en:"High score test"}
                ]
            }
        }
    },
    stu_uni: {
        type: 'study', es: "Universidad / College", en: "University",
        jobs: {
            stem: {
                es: "Ciencias / Ingenier√≠a", en: "STEM Major",
                m: [
                    {s:'str', xp:200, t_es:"Laboratorio", d_es:"Reporte completado", t_en:"Lab Report", d_en:"Finished report"},
                    {s:'int', xp:100, t_es:"Problemas", d_es:"Set de ejercicios", t_en:"Problem Set", d_en:"Exercises done"},
                    {s:'int', xp:300, t_es:"Parcial / Midterm", d_es:"Examen aprobado", t_en:"Midterm", d_en:"Exam passed"}
                ]
            },
            arts: {
                es: "Humanidades / Artes", en: "Arts / Humanities",
                m: [
                    {s:'str', xp:150, t_es:"Lectura Intensa", d_es:"50+ p√°ginas le√≠das", t_en:"Heavy Reading", d_en:"50+ pages read"},
                    {s:'int', xp:250, t_es:"Ensayo", d_es:"Escribir 5 p√°ginas", t_en:"Essay", d_en:"Write 5 pages"}
                ]
            }
        }
    }
};

/* --- TEXTOS --- */
const T = {
    es: { t_create:"CREA TU PERFIL", l_name:"Nombre", l_clan:"Clan", l_cat:"Industria", l_cat_s:"Nivel Educativo", l_job:"Especialidad", l_job_s:"Carrera", b_start:"EMPEZAR", l_lvl:"Nivel", s_str:"FUERZA", s_cha:"CARISMA", s_int:"MENTE", b_reset:"Reiniciar Todo", t_danger:"ZONA DE PELIGRO", d_reset:"Escribe tu nombre para borrar:", b_del:"BORRAR", clans:["ü¶Å Leones (L√≠deres)","ü¶ä Diplom√°ticos (Social)","üîÆ Magos (Creativos)","üêç Serpientes (Estrategia)","üêê Monta√±eses (Resistencia)"] },
    en: { t_create:"CREATE PROFILE", l_name:"Name", l_clan:"Clan", l_cat:"Industry", l_cat_s:"Education Level", l_job:"Specialty", l_job_s:"Major", b_start:"START", l_lvl:"Level", s_str:"STRENGTH", s_cha:"CHARISMA", s_int:"MIND", b_reset:"Reset All", t_danger:"DANGER ZONE", d_reset:"Type name to delete:", b_del:"DELETE", clans:["ü¶Å Lions (Leaders)","ü¶ä Diplomats (Social)","üîÆ Mages (Creatives)","üêç Serpents (Strategy)","üêê Mountaineers (Stamina)"] }
};

let lang = 'es';
let mode = 'work';
let player = { name:"", clan:"", cat:"", job:"", lvl:1, xp:0, next:1000, stats:{str:0, cha:0, int:0} };

window.onload = () => {
    try {
        lang = localStorage.getItem('rpg_lang') || 'es';
        setLang(lang, false);
        
        // Cargar Clanes
        const clanSel = document.getElementById('inp-clan');
        clanSel.innerHTML = "";
        T[lang].clans.forEach((c, i) => {
            let opt = document.createElement('option');
            opt.value = i; opt.innerText = c; clanSel.appendChild(opt);
        });

        // Cargar Jugador
        const save = localStorage.getItem('rpg_save_stable');
        if(save) {
            player = JSON.parse(save);
            // Verificar integridad de datos
            if(!player.stats) player.stats = {str:0, cha:0, int:0};
            initGame();
        } else {
            document.getElementById('screen-create').classList.add('active');
            setMode('work');
        }
    } catch (e) {
        console.error(e);
        localStorage.clear(); // Si falla, limpiar para evitar bloqueo
        location.reload();
    }
};

function setMode(m) {
    mode = m;
    document.getElementById('t-work').className = m === 'work' ? 'mode-btn active' : 'mode-btn';
    document.getElementById('t-study').className = m === 'study' ? 'mode-btn active' : 'mode-btn';
    
    document.getElementById('lbl-cat').innerText = m === 'work' ? T[lang].l_cat : T[lang].l_cat_s;
    document.getElementById('lbl-job').innerText = m === 'work' ? T[lang].l_job : T[lang].l_job_s;

    const catSel = document.getElementById('inp-category');
    catSel.innerHTML = "";
    Object.keys(DB).forEach(k => {
        if (DB[k].type === m) {
            let opt = document.createElement('option');
            opt.value = k;
            opt.innerText = DB[k][lang];
            catSel.appendChild(opt);
        }
    });
    updateSubSelect();
}

function updateSubSelect() {
    const cat = document.getElementById('inp-category').value;
    const jobSel = document.getElementById('inp-job');
    jobSel.innerHTML = "";
    if (cat && DB[cat]) {
        const jobs = DB[cat].jobs;
        Object.keys(jobs).forEach(k => {
            let opt = document.createElement('option');
            opt.value = k;
            opt.innerText = jobs[k][lang];
            jobSel.appendChild(opt);
        });
    }
}

function setLang(l, reload=true) {
    lang = l; localStorage.setItem('rpg_lang', l);
    document.getElementById('btn-es').classList.toggle('active', l==='es');
    document.getElementById('btn-en').classList.toggle('active', l==='en');
    document.querySelectorAll('[data-t]').forEach(e => {
        if(T[l][e.dataset.t]) e.innerText = T[l][e.dataset.t];
    });
    if(reload) location.reload();
}

function startGame() {
    const n = document.getElementById('inp-name').value;
    if(!n) return alert("Name required");
    player.name = n;
    const clanIdx = document.getElementById('inp-clan').value;
    player.clan = T[lang].clans[clanIdx];
    player.cat = document.getElementById('inp-category').value;
    player.job = document.getElementById('inp-job').value;
    save(); initGame();
}

function initGame() {
    document.getElementById('screen-create').classList.remove('active');
    document.getElementById('screen-game').classList.add('active');
    renderUI();
}

function renderUI() {
    document.getElementById('ui-name').innerText = player.name;
    let jobName = player.job;
    // Intentar traducir trabajo
    try {
        if(DB[player.cat] && DB[player.cat].jobs[player.job]) {
            jobName = DB[player.cat].jobs[player.job][lang];
        }
    } catch(e) { jobName = player.job; }
    
    document.getElementById('ui-job').innerText = jobName;
    document.getElementById('ui-clan').innerText = player.clan ? (player.clan.split(' ')[0] + " " + player.clan.split(' ')[1]) : "Clan"; 
    document.getElementById('ui-lvl').innerText = player.lvl;
    document.getElementById('v-str').innerText = player.stats.str;
    document.getElementById('v-cha').innerText = player.stats.cha;
    document.getElementById('v-int').innerText = player.stats.int;
    
    const pct = (player.xp / player.next)*100;
    document.getElementById('ui-xp').style.width = pct+"%";
    document.getElementById('ui-xp-txt').innerText = Math.floor(player.xp)+"/"+player.next;
    document.getElementById('reset-hint').innerText = player.name;

    renderMissions();
}

function renderMissions() {
    const area = document.getElementById('missions-area');
    area.innerHTML = "";
    let missions = [];
    
    if(DB[player.cat] && DB[player.cat].jobs[player.job]) {
        missions = DB[player.cat].jobs[player.job].m;
    }

    ['str', 'cha', 'int'].forEach(stat => {
        const group = document.createElement('div');
        group.className = 'm-group';
        const title = document.createElement('div');
        title.className = 'm-head';
        title.innerText = T[lang]['s_'+stat];
        group.appendChild(title);
        
        const statMissions = missions.filter(m => m.s === stat);
        if(statMissions.length === 0) {
           // Si no hay misiones para este stat, poner placeholder vac√≠o o gen√©rico (opcional)
        }

        statMissions.forEach(m => {
            const btn = document.createElement('div');
            btn.className = 'm-btn';
            btn.onclick = () => gain(m.xp, m.s);
            btn.innerHTML = `
                <div class="m-info">
                    <span class="m-title">${lang==='es'?m.t_es:m.t_en}</span>
                    <span class="m-desc">${lang==='es'?m.d_es:m.d_en}</span>
                </div>
                <div class="xp-badge">+${m.xp}</div>
            `;
            group.appendChild(btn);
        });
        area.appendChild(group);
    });
}

function gain(xp, stat) {
    player.xp += xp; player.stats[stat]++;
    let msg = `+${xp} XP`;
    if(player.xp >= player.next) {
        player.lvl++; player.xp -= player.next; player.next = Math.floor(player.next*1.2);
        msg = "üéâ LEVEL UP!";
    }
    save(); renderUI(); toast(msg);
}

function toast(m) {
    const t = document.getElementById('toast');
    t.innerText = m; t.style.opacity=1; t.style.bottom="40px";
    setTimeout(()=>{t.style.opacity=0; t.style.bottom="30px"}, 2000);
}

function save() { localStorage.setItem('rpg_save_stable', JSON.stringify(player)); }
function openReset() { document.getElementById('modal-reset').style.display='flex'; }
function closeReset() { document.getElementById('modal-reset').style.display='none'; }
function confirmReset() {
    if(document.getElementById('inp-reset').value === player.name) {
        localStorage.removeItem('rpg_save_stable'); location.reload();
    } else alert("Error");
}
</script>
</body>
</html>
