<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG Life: Infinite</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #3b82f6; --accent: #8b5cf6; --gold: #f59e0b; --danger: #ef4444; --text: #f8fafc; --muted: #94a3b8; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 420px; position: relative; padding-bottom: 50px; }
        
        /* UI Basics */
        .lang-switch { position: absolute; top: -35px; right: 0; display: flex; gap: 5px; }
        .lang-btn { background: var(--card); border: 1px solid #334155; color: var(--muted); padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; cursor: pointer; }
        .lang-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .screen { display: none; animation: fade 0.4s; }
        .active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h1 { text-align: center; color: var(--primary); margin: 0 0 15px 0; font-size: 24px; }
        label { display: block; color: var(--muted); font-size: 11px; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
        select, input { width: 100%; padding: 12px; background: var(--card); border: 2px solid #334155; color: white; border-radius: 8px; font-size: 15px; margin-bottom: 15px; outline: none; box-sizing: border-box; }
        select:focus, input:focus { border-color: var(--primary); }
        
        .btn-main { background: linear-gradient(135deg, var(--primary), var(--accent)); width: 100%; padding: 14px; border: none; border-radius: 10px; color: white; font-weight: bold; font-size: 16px; margin-top: 10px; cursor: pointer; transition: 0.2s; }
        .btn-main:active { transform: scale(0.98); opacity: 0.9; }

        /* Mode Toggle */
        .mode-toggle { display: flex; background: var(--card); border-radius: 10px; padding: 4px; margin-bottom: 20px; border: 1px solid #334155; }
        .mode-btn { flex: 1; border: none; background: none; color: var(--muted); padding: 10px; font-weight: bold; font-size: 13px; cursor: pointer; border-radius: 8px; }
        .mode-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* Custom Input Area */
        #custom-area { display: none; background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 10px; border: 1px dashed var(--primary); margin-bottom: 15px; }
        #custom-area.show { display: block; animation: fade 0.3s; }

        /* Profile Card */
        .profile-card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #334155; position: relative; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .clan-tag { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-size: 10px; color: var(--accent); border: 1px solid var(--accent); }
        .char-name { font-size: 22px; font-weight: 800; margin-bottom: 4px; }
        .char-job { color: var(--muted); font-size: 13px; display: block; margin-bottom: 12px; font-style: italic; }
        
        .level-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 6px; font-size: 12px; color: var(--muted); }
        .lvl-big { font-size: 26px; color: var(--gold); font-weight: bold; line-height: 1; }
        .xp-bar-bg { background: #0f172a; height: 10px; border-radius: 5px; overflow: hidden; border: 1px solid #334155; }
        .xp-bar-fill { background: linear-gradient(90deg, var(--gold), #fcd34d); height: 100%; width: 0%; transition: width 0.4s cubic-bezier(0.25, 1, 0.5, 1); }

        /* Stats Grid */
        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .stat-box { background: #0f172a; padding: 12px 5px; border-radius: 10px; text-align: center; border: 1px solid #334155; }
        .s-val { font-size: 22px; font-weight: bold; display: block; line-height: 1.1; }
        .s-lbl { font-size: 9px; color: var(--muted); font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .c-str { color: #ef4444; } .c-cha { color: #f472b6; } .c-int { color: #3b82f6; }

        /* Missions List */
        .m-group { margin-bottom: 15px; }
        .m-head { font-size: 10px; color: var(--muted); font-weight: bold; text-transform: uppercase; border-bottom: 1px solid #334155; margin-bottom: 8px; padding-bottom: 4px; letter-spacing: 1px; }
        .m-btn { 
            background: var(--card); border: 1px solid #334155; padding: 14px; border-radius: 12px; 
            margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; 
            color: white; text-align: left; cursor: pointer; transition: 0.1s; position: relative; overflow: hidden;
        }
        .m-btn:active { transform: scale(0.98); background: #334155; border-color: var(--primary); }
        .m-info { flex: 1; margin-right: 10px; }
        .m-title { font-size: 14px; font-weight: 600; display: block; margin-bottom: 2px; }
        .m-desc { font-size: 11px; color: var(--muted); }
        .xp-badge { background: rgba(255,255,255,0.08); padding: 6px 10px; border-radius: 8px; font-size: 12px; color: var(--gold); font-weight: bold; min-width: 50px; text-align: center; }

        /* Helpers */
        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--gold); color: black; padding: 10px 20px; border-radius: 30px; font-weight: bold; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 99; width: 80%; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .settings-link { display: block; text-align: center; color: #475569; font-size: 12px; text-decoration: underline; margin-top: 20px; cursor: pointer; padding: 10px; }
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        .modal { background: var(--card); padding: 25px; border-radius: 15px; width: 100%; max-width: 320px; text-align: center; border: 1px solid var(--danger); }
        #error-msg { display:none; color:white; background:#ef4444; padding:20px; position:fixed; top:0; left:0; width:100%; z-index:9999; text-align:center; }
    </style>
</head>
<body>

<div id="error-msg">Error de datos. <button onclick="localStorage.clear();location.reload()">Reset</button></div>

<div class="container">
    <div class="lang-switch">
        <button class="lang-btn active" id="btn-es" onclick="setLang('es')">ES</button>
        <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
    </div>

    <div id="screen-create" class="screen">
        <h1 data-t="t_create">CREA TU PERFIL</h1>
        
        <div class="mode-toggle">
            <button class="mode-btn active" id="t-work" onclick="setMode('work')">üëî TRABAJO</button>
            <button class="mode-btn" id="t-study" onclick="setMode('study')">üéì ESTUDIO</button>
        </div>

        <label data-t="l_name">Nombre</label>
        <input type="text" id="inp-name" placeholder="...">
        
        <label data-t="l_clan">Clan</label>
        <select id="inp-clan"></select>

        <label id="lbl-cat" data-t="l_cat">Industria / Facultad</label>
        <select id="inp-category" onchange="updateSubSelect()"></select>

        <label id="lbl-job" data-t="l_job">Rol / Carrera</label>
        <select id="inp-job" onchange="checkCustomJob()"></select>

        <div id="custom-area">
            <label style="color:var(--primary)">‚ú® <span data-t="l_custom">Escribe tu Rol Exacto:</span></label>
            <input type="text" id="inp-custom-text" placeholder="Ej: Astronauta, Domador...">
        </div>

        <button class="btn-main" onclick="startGame()" data-t="b_start">COMENZAR AVENTURA</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="profile-card">
            <span class="clan-tag" id="ui-clan">Clan</span>
            <div class="char-name" id="ui-name">Name</div>
            <span class="char-job" id="ui-job">Job Title</span>
            <div class="level-row">
                <span data-t="l_lvl">Nivel Actual</span>
                <span class="lvl-big" id="ui-lvl">1</span>
            </div>
            <div class="xp-bar-bg"><div class="xp-bar-fill" id="ui-xp"></div></div>
            <div style="text-align:right; font-size:10px; color:#64748b; margin-top:4px" id="ui-xp-txt">0/1000</div>
        </div>

        <div class="stats">
            <div class="stat-box"><span class="s-val c-str" id="v-str">0</span><span class="s-lbl" data-t="s_str">FUERZA</span></div>
            <div class="stat-box"><span class="s-val c-cha" id="v-cha">0</span><span class="s-lbl" data-t="s_cha">CARISMA</span></div>
            <div class="stat-box"><span class="s-val c-int" id="v-int">0</span><span class="s-lbl" data-t="s_int">MENTE</span></div>
        </div>

        <div id="missions-area"></div>
        <div class="settings-link" onclick="openReset()" data-t="b_reset">Reiniciar / Reset</div>
    </div>
</div>

<div class="modal-bg" id="modal-reset">
    <div class="modal">
        <h3 style="color:var(--danger)" data-t="t_danger">‚ö†Ô∏è ZONA DE PELIGRO</h3>
        <p style="font-size:13px; color:#ccc" data-t="d_reset">Escribe tu nombre exacto:</p>
        <strong id="reset-hint" style="color:white; display:block; margin-bottom:10px">NAME</strong>
        <input type="text" id="inp-reset" style="text-align:center">
        <button class="btn-main" style="background:var(--danger)" onclick="confirmReset()" data-t="b_del">BORRAR</button>
        <button style="background:none; border:none; color:#888; text-decoration:underline; margin-top:10px" onclick="closeReset()">Cancelar</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* =========================================
   BASE DE DATOS MASIVA (JOB DB)
   ========================================= */
const DB = {
    // ================== TRABAJO / WORK ==================
    w_trades: {
        type: 'work', es: "Oficios / Construcci√≥n", en: "Trades / Construction",
        jobs: {
            cleaning: { es: "Limpieza / Pressure Washing", en: "Cleaning / Pressure Washing", m: [{s:'str',xp:100,t_es:"Prep. Equipo",d_es:"Mezclar qu√≠micos/Revisar aceite",t_en:"Prep Gear",d_en:"Mix chems/Check oil"},{s:'str',xp:300,t_es:"Trabajo Completo",d_es:"Limpiar casa/techo entero",t_en:"Full Job",d_en:"Full house/roof clean"},{s:'cha',xp:150,t_es:"Foto WOW",d_es:"Enviar Antes/Despu√©s a cliente",t_en:"WOW Pic",d_en:"Send Before/After"},{s:'int',xp:200,t_es:"Cotizaci√≥n",d_es:"Medir √°rea y calcular precio",t_en:"Quote",d_en:"Measure area/price"}] },
            mechanic: { es: "Mec√°nico / Automotriz", en: "Mechanic / Automotive", m: [{s:'str',xp:150,t_es:"Servicio B√°sico",d_es:"Aceite/Frenos/Llantas",t_en:"Basic Service",d_en:"Oil/Brakes/Tires"},{s:'str',xp:300,t_es:"Reparaci√≥n Mayor",d_es:"Motor/Transmisi√≥n",t_en:"Major Repair",d_en:"Engine/Transmission"},{s:'int',xp:200,t_es:"Diagn√≥stico",d_es:"Encontrar la falla exacta",t_en:"Diagnosis",d_en:"Find exact fault"},{s:'cha',xp:100,t_es:"Explicaci√≥n",d_es:"Explicar reparaci√≥n a cliente",t_en:"Explain",d_en:"Explain fix to client"}] },
            construction: { es: "Construcci√≥n General", en: "General Construction", m: [{s:'str',xp:200,t_es:"Jornada Dura",d_es:"8h de labor f√≠sica",t_en:"Hard Day",d_en:"8h physical labor"},{s:'str',xp:100,t_es:"Carga",d_es:"Mover materiales pesados",t_en:"Hauling",d_en:"Move heavy mats"},{s:'int',xp:150,t_es:"Medir/Cortar",d_es:"Precisi√≥n en cortes",t_en:"Measure/Cut",d_en:"Precision cuts"}] },
            electric: { es: "Electricista", en: "Electrician", m: [{s:'str',xp:150,t_es:"Cableado",d_es:"Instalar l√≠neas nuevas",t_en:"Wiring",d_en:"Run new lines"},{s:'int',xp:250,t_es:"Troubleshoot",d_es:"Rastrear corto/falla",t_en:"Troubleshoot",d_en:"Trace short/fault"},{s:'int',xp:100,t_es:"Seguridad",d_es:"Verificar breakers/tierra",t_en:"Safety",d_en:"Check breakers/ground"}] },
            plumbing: { es: "Plomero / Fontanero", en: "Plumber", m: [{s:'str',xp:200,t_es:"Instalaci√≥n",d_es:"Ba√±o/Cocina/Tuber√≠a",t_en:"Install",d_en:"Bath/Kitchen/Pipe"},{s:'str',xp:300,t_es:"Trabajo Sucio",d_es:"Drenaje/Alcantarilla",t_en:"Dirty Work",d_en:"Drain/Sewer"},{s:'int',xp:150,t_es:"Detectar Fuga",d_es:"Encontrar origen de agua",t_en:"Leak Detect",d_en:"Find water source"}] },
            beauty: { es: "Belleza / Barber√≠a", en: "Beauty / Barber", m: [{s:'str',xp:100,t_es:"De Pie",d_es:"3 clientes seguidos",t_en:"Standing",d_en:"3 clients in a row"},{s:'cha',xp:200,t_es:"Terapia",d_es:"Escuchar al cliente",t_en:"Therapy",d_en:"Listen to client"},{s:'int',xp:150,t_es:"T√©cnica Nueva",d_es:"Aprender corte/color",t_en:"New Tech",d_en:"Learn cut/color"}] },
            food: { es: "Gastronom√≠a / Cocina", en: "Culinary / Kitchen", m: [{s:'str',xp:200,t_es:"Servicio (Rush)",d_es:"Hora pico sin errores",t_en:"Service Rush",d_en:"Peak hour no errors"},{s:'str',xp:100,t_es:"Prep/Mise en place",d_es:"Picar y organizar todo",t_en:"Prep",d_en:"Chop and organize"},{s:'int',xp:150,t_es:"Inventario",d_es:"Control de stock/costos",t_en:"Inventory",d_en:"Stock/cost control"}] },
            driver: { es: "Transporte / Chofer", en: "Transport / Driver", m: [{s:'str',xp:150,t_es:"Ruta Larga",d_es:"4h+ de conducci√≥n",t_en:"Long Haul",d_en:"4h+ driving"},{s:'int',xp:100,t_es:"Navegaci√≥n",d_es:"Optimizar ruta/tr√°fico",t_en:"Nav",d_en:"Optimize route"},{s:'int',xp:100,t_es:"Mantenimiento",d_es:"Revisi√≥n de cami√≥n/auto",t_en:"Maint",d_en:"Check truck/car"}] }
        }
    },
    w_corp: {
        type: 'work', es: "Oficina / Corporativo", en: "Corporate / Office",
        jobs: {
            sales: { es: "Ventas / Sales Rep", en: "Sales Rep", m: [{s:'cha',xp:100,t_es:"Prospecting",d_es:"10 llamadas/emails fr√≠os",t_en:"Prospecting",d_en:"10 cold calls/emails"},{s:'cha',xp:200,t_es:"Demo/Reuni√≥n",d_es:"Presentaci√≥n a cliente",t_en:"Demo",d_en:"Client presentation"},{s:'cha',xp:500,t_es:"CERRAR",d_es:"Contrato firmado",t_en:"CLOSE",d_en:"Signed contract"},{s:'int',xp:100,t_es:"CRM",d_es:"Actualizar datos leads",t_en:"CRM",d_en:"Update lead data"}] },
            marketing: { es: "Marketing / Redes", en: "Marketing", m: [{s:'int',xp:150,t_es:"Campa√±a",d_es:"Lanzar ads/email",t_en:"Campaign",d_en:"Launch ads/email"},{s:'int',xp:100,t_es:"Analytics",d_es:"Reporte de m√©tricas",t_en:"Analytics",d_en:"Metrics report"},{s:'cha',xp:150,t_es:"Contenido",d_es:"Crear post/video viral",t_en:"Content",d_en:"Create viral post"}] },
            admin: { es: "Administraci√≥n / Asistente", en: "Admin / Assistant", m: [{s:'int',xp:100,t_es:"Inbox Zero",d_es:"Limpiar correos",t_en:"Inbox Zero",d_en:"Clear emails"},{s:'cha',xp:150,t_es:"Coordinar",d_es:"Agendar reuniones complejas",t_en:"Coordination",d_en:"Schedule complex meetings"},{s:'int',xp:200,t_es:"Reporte",d_es:"Preparar doc para jefe",t_en:"Report",d_en:"Prep doc for boss"}] },
            finance: { es: "Finanzas / Contabilidad", en: "Finance / Accounting", m: [{s:'int',xp:150,t_es:"Cierre Mes",d_es:"Conciliaci√≥n bancaria",t_en:"Month Close",d_en:"Bank reconciliation"},{s:'int',xp:200,t_es:"Auditor√≠a",d_es:"Revisar errores en Excel",t_en:"Audit",d_en:"Check Excel errors"},{s:'int',xp:100,t_es:"Impuestos",d_es:"Preparar declaraci√≥n",t_en:"Taxes",d_en:"Prep tax forms"}] }
        }
    },
    w_tech: {
        type: 'work', es: "Tecnolog√≠a / IT", en: "Technology / IT",
        jobs: {
            dev: { es: "Desarrollador / Software", en: "Developer", m: [{s:'str',xp:100,t_es:"Deep Code",d_es:"1h sin distracciones",t_en:"Deep Code",d_en:"1h no distractions"},{s:'int',xp:150,t_es:"Debug",d_es:"Arreglar error dif√≠cil",t_en:"Debug",d_en:"Fix hard bug"},{s:'str',xp:300,t_es:"Deploy",d_es:"Subir a producci√≥n",t_en:"Deploy",d_en:"Push to prod"}] },
            support: { es: "Soporte IT / Sysadmin", en: "IT Support", m: [{s:'str',xp:100,t_es:"Tickets",d_es:"Resolver 5 tickets",t_en:"Tickets",d_en:"Solve 5 tickets"},{s:'int',xp:200,t_es:"Redes",d_es:"Configurar router/server",t_en:"Network",d_en:"Config router/server"},{s:'cha',xp:150,t_es:"Ayuda Usuario",d_es:"Explicar pacientemente",t_en:"User Help",d_en:"Explain patiently"}] }
        }
    },
    // ================== ESTUDIO / STUDY ==================
    s_health: {
        type: 'study', es: "Facultad: Salud", en: "Faculty: Health",
        jobs: {
            med: { es: "Medicina", en: "Medicine", m: [{s:'str',xp:300,t_es:"Guardia",d_es:"Turno de noche",t_en:"Night Shift",d_en:"Hospital rotation"},{s:'int',xp:150,t_es:"Anatom√≠a",d_es:"Estudio de sistemas",t_en:"Anatomy",d_en:"Systems study"},{s:'cha',xp:100,t_es:"Historia Cl√≠nica",d_es:"Entrevistar paciente",t_en:"History",d_en:"Interview patient"}] },
            nursing: { es: "Enfermer√≠a", en: "Nursing", m: [{s:'str',xp:200,t_es:"Pr√°ctica Cl√≠nica",d_es:"Atenci√≥n directa",t_en:"Clinical",d_en:"Direct care"},{s:'int',xp:150,t_es:"Farmacolog√≠a",d_es:"Estudiar dosis",t_en:"Pharma",d_en:"Study dosage"},{s:'cha',xp:150,t_es:"Cuidado",d_es:"Apoyo emocional",t_en:"Care",d_en:"Emotional support"}] },
            psych: { es: "Psicolog√≠a", en: "Psychology", m: [{s:'int',xp:150,t_es:"Lectura Teor√≠a",d_es:"Teor√≠a densa",t_en:"Theory",d_en:"Heavy theory"},{s:'cha',xp:200,t_es:"Pr√°ctica Terapia",d_es:"Simulaci√≥n sesi√≥n",t_en:"Session",d_en:"Simulated therapy"},{s:'int',xp:150,t_es:"Estad√≠stica",d_es:"An√°lisis de datos",t_en:"Stats",d_en:"Data analysis"}] }
        }
    },
    s_eng: {
        type: 'study', es: "Facultad: Ingenier√≠a", en: "Faculty: Engineering",
        jobs: {
            civil: { es: "Ing. Civil / Arquitectura", en: "Civil Eng / Arch", m: [{s:'int',xp:200,t_es:"C√°lculo Estructural",d_es:"F√≠sica avanzada",t_en:"Calculus",d_en:"Adv Physics"},{s:'str',xp:150,t_es:"Maqueta/Plano",d_es:"Horas dibujando",t_en:"Model/Plan",d_en:"Hours drawing"},{s:'int',xp:100,t_es:"Materiales",d_es:"Estudio resistencia",t_en:"Materials",d_en:"Resistance study"}] },
            comp: { es: "Ing. Sistemas / Software", en: "Comp Sci", m: [{s:'str',xp:150,t_es:"Marat√≥n C√≥digo",d_es:"Proyecto final",t_en:"Code Marathon",d_en:"Final project"},{s:'int',xp:100,t_es:"Algoritmos",d_es:"Estructuras de datos",t_en:"Algos",d_en:"Data structures"},{s:'int',xp:200,t_es:"Matem√°tica Discreta",d_es:"L√≥gica pura",t_en:"Discrete Math",d_en:"Pure logic"}] },
            ind: { es: "Ing. Industrial", en: "Industrial Eng", m: [{s:'int',xp:150,t_es:"Optimizaci√≥n",d_es:"Mejorar procesos",t_en:"Optimization",d_en:"Improve process"},{s:'cha',xp:150,t_es:"Gesti√≥n",d_es:"Liderar grupo",t_en:"Management",d_en:"Lead group"},{s:'int',xp:150,t_es:"Finanzas",d_es:"Costos y presupuestos",t_en:"Finance",d_en:"Costs/Budgets"}] }
        }
    },
    s_biz: {
        type: 'study', es: "Facultad: Negocios", en: "Faculty: Business",
        jobs: {
            admin: { es: "Administraci√≥n / Negocios", en: "Business Admin", m: [{s:'cha',xp:200,t_es:"Presentaci√≥n",d_es:"Exponer estrategia",t_en:"Presentation",d_en:"Pitch strategy"},{s:'int',xp:150,t_es:"Caso de Estudio",d_es:"Analizar empresa real",t_en:"Case Study",d_en:"Analyze real co"},{s:'cha',xp:100,t_es:"Networking",d_es:"Evento social",t_en:"Networking",d_en:"Social event"}] },
            acct: { es: "Contabilidad", en: "Accounting", m: [{s:'int',xp:200,t_es:"Balance General",d_es:"Cuadrar todo",t_en:"Balance Sheet",d_en:"Balance everything"},{s:'int',xp:150,t_es:"Leyes Tributarias",d_es:"Memorizar normas",t_en:"Tax Law",d_en:"Memorize rules"}] }
        }
    },
    s_arts: {
        type: 'study', es: "Facultad: Artes/Sociales", en: "Faculty: Arts/Social",
        jobs: {
            law: { es: "Derecho / Leyes", en: "Law", m: [{s:'str',xp:200,t_es:"Lectura Masiva",d_es:"100 p√°gs de fallos",t_en:"Heavy Read",d_en:"100 pages cases"},{s:'cha',xp:200,t_es:"Debate/Juicio",d_es:"Argumentar caso",t_en:"Debate/Trial",d_en:"Argue case"},{s:'int',xp:150,t_es:"Memorizar",d_es:"Art√≠culos/C√≥digos",t_en:"Memorize",d_en:"Codes/Articles"}] },
            art: { es: "Dise√±o / Arte", en: "Design / Art", m: [{s:'str',xp:200,t_es:"Taller",d_es:"Horas pintando/editando",t_en:"Studio",d_en:"Hours painting/editing"},{s:'int',xp:150,t_es:"Historia del Arte",d_es:"Ensayo te√≥rico",t_en:"Art History",d_en:"Theory essay"},{s:'cha',xp:150,t_es:"Cr√≠tica",d_es:"Presentar portafolio",t_en:"Critique",d_en:"Present portfolio"}] }
        }
    },
    s_hs: {
        type: 'study', es: "Escuela / Secundaria", en: "High School",
        jobs: {
            hs: { es: "Estudiante General", en: "Student", m: [{s:'str',xp:100,t_es:"Tarea",d_es:"A tiempo y completa",t_en:"Homework",d_en:"On time/complete"},{s:'int',xp:200,t_es:"Examen",d_es:"Estudiar y aprobar",t_en:"Exam",d_en:"Study and pass"},{s:'str',xp:150,t_es:"Deporte",d_es:"Educaci√≥n f√≠sica/Club",t_en:"Sports",d_en:"PE/Club activity"}] }
        }
    },
    // GENERIC FALLBACK
    custom: {
        type: 'any', es: "Otro / Personalizado", en: "Other / Custom",
        jobs: {
            custom_job: { es: "Personalizado", en: "Custom Role", m: [] } // Will be generated
        }
    }
};

/* --- TEXTOS UI --- */
const T = {
    es: { t_create:"CREA TU PERFIL", l_name:"Nombre", l_clan:"Clan", l_cat:"Sector / Facultad", l_job:"Rol / Carrera", b_start:"EMPEZAR", l_lvl:"Nivel", s_str:"FUERZA", s_cha:"CARISMA", s_int:"MENTE", b_reset:"Reiniciar Todo", t_danger:"ZONA DE PELIGRO", d_reset:"Escribe tu nombre para borrar:", b_del:"BORRAR", l_custom:"Escribe tu Rol Exacto:", clans:["ü¶Å Leones (Liderazgo)","ü¶ä Zorros (Astucia)","üîÆ Magos (Creatividad)","üêç Serpientes (Ambici√≥n)","üêê Cabras (Persistencia)"] },
    en: { t_create:"CREATE PROFILE", l_name:"Name", l_clan:"Clan", l_cat:"Sector / Faculty", l_job:"Role / Major", b_start:"START", l_lvl:"Level", s_str:"STRENGTH", s_cha:"CHARISMA", s_int:"MIND", b_reset:"Reset All", t_danger:"DANGER ZONE", d_reset:"Type name to delete:", b_del:"DELETE", l_custom:"Type your Exact Role:", clans:["ü¶Å Lions (Leadership)","ü¶ä Foxes (Cunning)","üîÆ Mages (Creativity)","üêç Serpents (Ambition)","üêê Goats (Persistence)"] }
};

let lang = 'es', mode = 'work', player = { name:"", clan:"", cat:"", job:"", customName:"", lvl:1, xp:0, next:1000, stats:{str:0, cha:0, int:0} };

window.onload = () => {
    try {
        lang = localStorage.getItem('rpg_lang') || 'es';
        setLang(lang, false);
        const clanSel = document.getElementById('inp-clan');
        clanSel.innerHTML = "";
        T[lang].clans.forEach((c, i) => { let o = document.createElement('option'); o.value = i; o.innerText = c; clanSel.appendChild(o); });

        const save = localStorage.getItem('rpg_save_v8');
        if(save) {
            player = JSON.parse(save);
            if(!player.stats) player.stats = {str:0, cha:0, int:0};
            initGame();
        } else {
            document.getElementById('screen-create').classList.add('active');
            setMode('work');
        }
    } catch(e) { document.getElementById('error-msg').style.display='block'; }
};

function setMode(m) {
    mode = m;
    document.getElementById('t-work').className = m === 'work' ? 'mode-btn active' : 'mode-btn';
    document.getElementById('t-study').className = m === 'study' ? 'mode-btn active' : 'mode-btn';
    
    const catSel = document.getElementById('inp-category');
    catSel.innerHTML = "";
    Object.keys(DB).forEach(k => {
        if(DB[k].type === m || DB[k].type === 'any') {
            let opt = document.createElement('option');
            opt.value = k; opt.innerText = DB[k][lang];
            catSel.appendChild(opt);
        }
    });
    updateSubSelect();
}

function updateSubSelect() {
    const cat = document.getElementById('inp-category').value;
    const jobSel = document.getElementById('inp-job');
    jobSel.innerHTML = "";
    if(cat && DB[cat]) {
        Object.keys(DB[cat].jobs).forEach(k => {
            let opt = document.createElement('option');
            opt.value = k; opt.innerText = DB[cat].jobs[k][lang];
            jobSel.appendChild(opt);
        });
    }
    checkCustomJob();
}

function checkCustomJob() {
    const cat = document.getElementById('inp-category').value;
    const box = document.getElementById('custom-area');
    if(cat === 'custom') box.classList.add('show');
    else box.classList.remove('show');
}

function setLang(l, r=true) {
    lang = l; localStorage.setItem('rpg_lang', l);
    document.getElementById('btn-es').classList.toggle('active', l==='es');
    document.getElementById('btn-en').classList.toggle('active', l==='en');
    document.querySelectorAll('[data-t]').forEach(e => { if(T[l][e.dataset.t]) e.innerText = T[l][e.dataset.t]; });
    if(r) location.reload();
}

function startGame() {
    const n = document.getElementById('inp-name').value;
    if(!n) return alert("Name required");
    player.name = n;
    player.clan = T[lang].clans[document.getElementById('inp-clan').value];
    player.cat = document.getElementById('inp-category').value;
    player.job = document.getElementById('inp-job').value;
    
    // CUSTOM LOGIC
    if(player.cat === 'custom') {
        const cText = document.getElementById('inp-custom-text').value;
        if(!cText) return alert("Please type your role");
        player.customName = cText;
    } else {
        player.customName = "";
    }

    save(); initGame();
}

function initGame() {
    document.getElementById('screen-create').classList.remove('active');
    document.getElementById('screen-game').classList.add('active');
    renderUI();
}

function renderUI() {
    document.getElementById('ui-name').innerText = player.name;
    
    // Determine Job Name Display
    let jName = player.job;
    if(player.cat === 'custom' && player.customName) {
        jName = player.customName.toUpperCase();
    } else {
        try { jName = DB[player.cat].jobs[player.job][lang]; } catch(e){}
    }
    
    document.getElementById('ui-job').innerText = jName;
    document.getElementById('ui-clan').innerText = player.clan.split(' ')[0]+" "+player.clan.split(' ')[1];
    document.getElementById('ui-lvl').innerText = player.lvl;
    document.getElementById('v-str').innerText = player.stats.str;
    document.getElementById('v-cha').innerText = player.stats.cha;
    document.getElementById('v-int').innerText = player.stats.int;
    const pct = (player.xp / player.next)*100;
    document.getElementById('ui-xp').style.width = pct+"%";
    document.getElementById('ui-xp-txt').innerText = Math.floor(player.xp)+"/"+player.next;
    document.getElementById('reset-hint').innerText = player.name;
    renderMissions();
}

function renderMissions() {
    const area = document.getElementById('missions-area');
    area.innerHTML = "";
    let missions = [];

    // LOGIC TO GET MISSIONS
    if(player.cat === 'custom') {
        // GENERADOR DE MISIONES (FAKE AI)
        const role = player.customName || "Role";
        missions = [
            {s:'str', xp:100, t_es:`Sesi√≥n Intensa de ${role}`, d_es:"1 hora de pr√°ctica/trabajo duro", t_en:`Hard ${role} Session`, d_en:"1 hour hard practice"},
            {s:'str', xp:250, t_es:`Proyecto Mayor de ${role}`, d_es:"Completar tarea dif√≠cil", t_en:`Major ${role} Task`, d_en:"Complete hard task"},
            {s:'cha', xp:150, t_es:`Networking de ${role}`, d_es:"Contactar o ayudar a alguien", t_en:`${role} Networking`, d_en:"Contact or help someone"},
            {s:'cha', xp:300, t_es:`Exponer Resultados`, d_es:"Mostrar tu trabajo a otros", t_en:`Show Results`, d_en:"Show work to others"},
            {s:'int', xp:150, t_es:`Estudiar Teor√≠a de ${role}`, d_es:"Leer o investigar 30 min", t_en:`Study ${role} Theory`, d_en:"Read or research 30 min"},
            {s:'int', xp:200, t_es:`Planificaci√≥n Estrat√©gica`, d_es:"Organizar semana de ${role}", t_en:`Strategic Planning`, d_en:"Organize week"}
        ];
    } else {
        try { missions = DB[player.cat].jobs[player.job].m; } catch(e){}
    }

    ['str', 'cha', 'int'].forEach(stat => {
        const ms = missions.filter(m => m.s === stat);
        if(ms.length > 0) {
            const grp = document.createElement('div'); grp.className='m-group';
            const h = document.createElement('div'); h.className='m-head'; h.innerText=T[lang]['s_'+stat]; grp.appendChild(h);
            ms.forEach(m => {
                const b = document.createElement('div'); b.className='m-btn'; b.onclick=()=>gain(m.xp, m.s);
                b.innerHTML = `<div class="m-info"><span class="m-title">${lang==='es'?m.t_es:m.t_en}</span><span class="m-desc">${lang==='es'?m.d_es:m.d_en}</span></div><div class="xp-badge">+${m.xp}</div>`;
                grp.appendChild(b);
            });
            area.appendChild(grp);
        }
    });
}

function gain(xp, s) {
    player.xp+=xp; player.stats[s]++;
    let m = `+${xp} XP`;
    if(player.xp >= player.next) { player.lvl++; player.xp-=player.next; player.next=Math.floor(player.next*1.2); m="üéâ LEVEL UP!"; }
    save(); renderUI(); toast(m);
}

function toast(m) {
    const t = document.getElementById('toast'); t.innerText=m; t.style.opacity=1; t.style.bottom="40px";
    setTimeout(()=>{t.style.opacity=0;t.style.bottom="30px"}, 2000);
}

function save() { localStorage.setItem('rpg_save_v8', JSON.stringify(player)); }
function openReset() { document.getElementById('modal-reset').style.display='flex'; }
function closeReset() { document.getElementById('modal-reset').style.display='none'; }
function confirmReset() {
    if(document.getElementById('inp-reset').value === player.name) { localStorage.removeItem('rpg_save_v8'); location.reload(); }
}
</script>
</body>
</html>
