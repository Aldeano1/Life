<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPG Life: Connected</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #3b82f6; --accent: #8b5cf6; --gold: #f59e0b; --danger: #ef4444; --text: #f8fafc; --muted: #94a3b8; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh; }
        .container { width: 100%; max-width: 450px; position: relative; padding-bottom: 50px; }
        
        .lang-switch { position: absolute; top: -35px; right: 0; display: flex; gap: 5px; }
        .lang-btn { background: var(--card); border: 1px solid #334155; color: var(--muted); padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; cursor: pointer; }
        .lang-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .screen { display: none; animation: fade 0.4s; }
        .active { display: block; }
        @keyframes fade { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        h1 { text-align: center; color: var(--primary); margin: 0 0 15px 0; font-size: 24px; }
        label { display: block; color: var(--muted); font-size: 11px; font-weight: bold; margin-bottom: 5px; text-transform: uppercase; }
        select, input { width: 100%; padding: 12px; background: var(--card); border: 2px solid #334155; color: white; border-radius: 8px; font-size: 15px; margin-bottom: 15px; outline: none; box-sizing: border-box; }
        select:focus, input:focus { border-color: var(--primary); }
        
        .btn-main { background: linear-gradient(135deg, var(--primary), var(--accent)); width: 100%; padding: 14px; border: none; border-radius: 10px; color: white; font-weight: bold; font-size: 16px; margin-top: 10px; cursor: pointer; }
        
        .mode-toggle { display: flex; background: var(--card); border-radius: 10px; padding: 4px; margin-bottom: 20px; border: 1px solid #334155; }
        .mode-btn { flex: 1; border: none; background: none; color: var(--muted); padding: 10px; font-weight: bold; font-size: 13px; cursor: pointer; border-radius: 8px; transition: 0.2s; }
        .mode-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        .profile-card { background: var(--card); padding: 20px; border-radius: 16px; border: 1px solid #334155; position: relative; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .clan-tag { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 6px; font-size: 10px; color: var(--accent); border: 1px solid var(--accent); }
        .char-name { font-size: 22px; font-weight: 800; margin-bottom: 4px; }
        .char-job { color: var(--muted); font-size: 13px; display: block; margin-bottom: 12px; font-style: italic; }
        
        .level-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 6px; font-size: 12px; color: var(--muted); }
        .lvl-big { font-size: 26px; color: var(--gold); font-weight: bold; line-height: 1; }
        .xp-bar-bg { background: #0f172a; height: 10px; border-radius: 5px; overflow: hidden; border: 1px solid #334155; }
        .xp-bar-fill { background: linear-gradient(90deg, var(--gold), #fcd34d); height: 100%; width: 0%; transition: width 0.4s; }

        .stats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .stat-box { background: #0f172a; padding: 12px 5px; border-radius: 10px; text-align: center; border: 1px solid #334155; }
        .s-val { font-size: 22px; font-weight: bold; display: block; line-height: 1.1; }
        .s-lbl { font-size: 9px; color: var(--muted); font-weight: bold; text-transform: uppercase; }
        .c-str { color: #ef4444; } .c-cha { color: #f472b6; } .c-int { color: #3b82f6; }

        .m-group { margin-bottom: 15px; }
        .m-head { font-size: 10px; color: var(--muted); font-weight: bold; text-transform: uppercase; border-bottom: 1px solid #334155; margin-bottom: 8px; padding-bottom: 4px; letter-spacing: 1px; }
        .m-btn { 
            background: var(--card); border: 1px solid #334155; padding: 14px; border-radius: 12px; 
            margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; 
            color: white; text-align: left; cursor: pointer; transition: 0.1s; position: relative; overflow: hidden;
        }
        .m-btn:active { transform: scale(0.98); background: #334155; border-color: var(--primary); }
        .m-info { flex: 1; margin-right: 10px; }
        .m-title { font-size: 14px; font-weight: 600; display: block; margin-bottom: 2px; }
        .m-desc { font-size: 11px; color: var(--muted); }
        .xp-badge { background: rgba(255,255,255,0.08); padding: 6px 10px; border-radius: 8px; font-size: 12px; color: var(--gold); font-weight: bold; min-width: 50px; text-align: center; }

        /* Bot√≥n Sync (Verde) */
        .btn-sync { background: #10b981; color: white; width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; letter-spacing: 0.5px; }
        .btn-sync:active { transform: scale(0.98); opacity: 0.9; }

        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--gold); color: black; padding: 10px 20px; border-radius: 30px; font-weight: bold; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 99; width: 80%; text-align: center; }
        .settings-link { display: block; text-align: center; color: #475569; font-size: 12px; text-decoration: underline; margin-top: 20px; cursor: pointer; padding: 10px; }
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        .modal { background: var(--card); padding: 25px; border-radius: 15px; width: 100%; max-width: 320px; text-align: center; border: 1px solid var(--danger); }
        #error-msg { display:none; color:white; background:#ef4444; padding:20px; position:fixed; top:0; left:0; width:100%; z-index:9999; text-align:center; }
    </style>
</head>
<body>

<div id="error-msg">Error. <button onclick="localStorage.clear();location.reload()">Reset</button></div>

<div class="container">
    <div class="lang-switch">
        <button class="lang-btn active" id="btn-es" onclick="setLang('es')">ES</button>
        <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
    </div>

    <div id="screen-create" class="screen">
        <h1 data-t="t_create">CREA TU PERFIL</h1>
        
        <div class="mode-toggle">
            <button class="mode-btn active" id="t-work" onclick="setMode('work')">üëî TRABAJO</button>
            <button class="mode-btn" id="t-study" onclick="setMode('study')">üéì ESTUDIO</button>
        </div>

        <label data-t="l_name">Nombre</label>
        <input type="text" id="inp-name" placeholder="...">
        
        <label data-t="l_clan">Clan</label>
        <select id="inp-clan"></select>

        <label id="lbl-job" data-t="l_job">Selecciona tu Profesi√≥n / Carrera</label>
        <select id="inp-job"></select>

        <button class="btn-main" onclick="startGame()" data-t="b_start">EMPEZAR</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="profile-card">
            <span class="clan-tag" id="ui-clan">Clan</span>
            <div class="char-name" id="ui-name">Name</div>
            <span class="char-job" id="ui-job">Job Title</span>
            <div class="level-row">
                <span data-t="l_lvl">Nivel Actual</span>
                <span class="lvl-big" id="ui-lvl">1</span>
            </div>
            <div class="xp-bar-bg"><div class="xp-bar-fill" id="ui-xp"></div></div>
            <div style="text-align:right; font-size:10px; color:#64748b; margin-top:4px" id="ui-xp-txt">0/1000</div>
        </div>

        <button class="btn-sync" onclick="syncData()">
            ‚òÅÔ∏è <span data-t="b_sync">GUARDAR EN LA NUBE</span>
        </button>

        <div class="stats">
            <div class="stat-box"><span class="s-val c-str" id="v-str">0</span><span class="s-lbl" data-t="s_str">FUERZA</span></div>
            <div class="stat-box"><span class="s-val c-cha" id="v-cha">0</span><span class="s-lbl" data-t="s_cha">CARISMA</span></div>
            <div class="stat-box"><span class="s-val c-int" id="v-int">0</span><span class="s-lbl" data-t="s_int">MENTE</span></div>
        </div>

        <div id="missions-area"></div>
        <div class="settings-link" onclick="openReset()" data-t="b_reset">Reiniciar / Reset</div>
    </div>
</div>

<div class="modal-bg" id="modal-reset">
    <div class="modal">
        <h3 style="color:var(--danger)" data-t="t_danger">‚ö†Ô∏è ZONA DE PELIGRO</h3>
        <p style="font-size:13px; color:#ccc" data-t="d_reset">Escribe tu nombre exacto:</p>
        <strong id="reset-hint" style="color:white; display:block; margin-bottom:10px">NAME</strong>
        <input type="text" id="inp-reset" style="text-align:center">
        <button class="btn-main" style="background:var(--danger)" onclick="confirmReset()" data-t="b_del">BORRAR</button>
        <button style="background:none; border:none; color:#888; text-decoration:underline; margin-top:10px" onclick="closeReset()">Cancelar</button>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* =========================================
   TU LINK DE FORMSPREE YA INTEGRADO AQU√ç
   ========================================= */
const API_URL = "https://formspree.io/f/xkobbevd"; 


/* BASE DE DATOS ROBUSTA */
const JOBS_DB = {
    // OFICIOS
    mechanic: { es: "Mec√°nico", en: "Mechanic", m: [{s:'str',xp:150,t:"Servicio R√°pido",d:"Cambio aceite/frenos"},{s:'int',xp:200,t:"Diagn√≥stico",d:"Hallar falla"},{s:'cha',xp:100,t:"Explicar",d:"Asesorar cliente"}] },
    electric: { es: "Electricista", en: "Electrician", m: [{s:'str',xp:150,t:"Cableado",d:"Instalar circuito"},{s:'int',xp:250,t:"Troubleshoot",d:"Rastrear corto"},{s:'int',xp:100,t:"Seguridad",d:"Testear tierra"}] },
    plumber: { es: "Plomero", en: "Plumber", m: [{s:'str',xp:200,t:"Instalaci√≥n",d:"Ba√±o/Cocina"},{s:'str',xp:300,t:"Desatascar",d:"Drenaje sucio"},{s:'int',xp:150,t:"Fugas",d:"Detectar origen"}] },
    welder: { es: "Soldador", en: "Welder", m: [{s:'str',xp:200,t:"Soldar",d:"Uni√≥n precisa"},{s:'int',xp:150,t:"Planos",d:"Leer simbolog√≠a"},{s:'str',xp:100,t:"Pulir",d:"Acabado limpio"}] },
    carpenter: { es: "Carpintero", en: "Carpenter", m: [{s:'str',xp:200,t:"Construir",d:"Estructura/Mueble"},{s:'int',xp:150,t:"Medir",d:"Corte exacto"},{s:'str',xp:100,t:"Lijar",d:"Acabado suave"}] },
    hvac: { es: "T√©cnico HVAC", en: "HVAC Tech", m: [{s:'str',xp:200,t:"Instalar A/C",d:"Montar unidad"},{s:'int',xp:200,t:"Carga Gas",d:"Medir presi√≥n"},{s:'str',xp:150,t:"Techos",d:"Trabajo altura"}] },
    mason: { es: "Alba√±il", en: "Mason", m: [{s:'str',xp:250,t:"Levantar Muro",d:"Hiladas niveladas"},{s:'str',xp:150,t:"Mezcla",d:"Preparar concreto"},{s:'int',xp:100,t:"Nivel",d:"Usar plomada"}] },
    painter: { es: "Pintor", en: "Painter", m: [{s:'str',xp:100,t:"Preparar",d:"Lijar/Tapar"},{s:'str',xp:200,t:"Pintar",d:"Rodillo/Brocha"},{s:'int',xp:100,t:"Detalle",d:"Recortes precisos"}] },
    landscaper: { es: "Jardinero", en: "Landscaper", m: [{s:'str',xp:200,t:"Podar",d:"Cortar c√©sped/arbol"},{s:'str',xp:300,t:"Plantar",d:"Instalar jard√≠n"},{s:'int',xp:100,t:"Riego",d:"Reparar sistema"}] },
    pw: { es: "Lavado Presi√≥n", en: "Pressure Washer", m: [{s:'str',xp:150,t:"Lavar Casa",d:"Limpiar siding"},{s:'str',xp:200,t:"Concreto",d:"Driveway/Piso"},{s:'int',xp:100,t:"Qu√≠micos",d:"Mezcla correcta"}] },
    pest: { es: "Control Plagas", en: "Pest Control", m: [{s:'int',xp:150,t:"Inspecci√≥n",d:"Buscar nidos"},{s:'str',xp:150,t:"Aplicar",d:"Rociar per√≠metro"},{s:'cha',xp:100,t:"Reporte",d:"Explicar cliente"}] },
    locksmith: { es: "Cerrajero", en: "Locksmith", m: [{s:'int',xp:200,t:"Apertura",d:"Abrir puerta"},{s:'int',xp:100,t:"Copia Llave",d:"Duplicado"},{s:'str',xp:150,t:"Instalar",d:"Cambiar chapa"}] },
    roofer: { es: "Techador", en: "Roofer", m: [{s:'str',xp:300,t:"Tejas",d:"Clavar shingles"},{s:'str',xp:150,t:"Arrancar",d:"Quitar viejo"},{s:'int',xp:150,t:"Sellar",d:"Impermeabilizar"}] },
    solar: { es: "Instalador Solar", en: "Solar Installer", m: [{s:'str',xp:200,t:"Paneles",d:"Montaje techo"},{s:'int',xp:200,t:"Conexi√≥n",d:"Inversor"},{s:'str',xp:150,t:"Seguridad",d:"Arn√©s/Altura"}] },
    
    // SERVICIO
    chef: { es: "Chef", en: "Chef", m: [{s:'str',xp:200,t:"Servicio",d:"Hora pico"},{s:'str',xp:100,t:"Mise en place",d:"Preparar todo"},{s:'int',xp:150,t:"Crear",d:"Plato nuevo"}] },
    bartender: { es: "Bartender", en: "Bartender", m: [{s:'str',xp:150,t:"Tragos",d:"Rapidez"},{s:'cha',xp:200,t:"Atenci√≥n",d:"Conversar"},{s:'int',xp:100,t:"Inventario",d:"Contar stock"}] },
    barista: { es: "Barista", en: "Barista", m: [{s:'int',xp:100,t:"Calibrar",d:"Espresso ok"},{s:'str',xp:150,t:"Rush",d:"Muchos pedidos"},{s:'cha',xp:100,t:"Arte",d:"Latte art"}] },
    server: { es: "Mesero", en: "Waiter", m: [{s:'str',xp:150,t:"Bandeja",d:"Llevar platos"},{s:'cha',xp:200,t:"Venta",d:"Sugerir postre"},{s:'int',xp:100,t:"Memoria",d:"Recordar orden"}] },
    frontdesk: { es: "Recepci√≥n", en: "Reception", m: [{s:'cha',xp:150,t:"Check-in",d:"Recibir hu√©sped"},{s:'cha',xp:200,t:"Queja",d:"Resolver problema"},{s:'int',xp:100,t:"Reservas",d:"Organizar"}] },
    flightatt: { es: "Azafata", en: "Flight Attendant", m: [{s:'cha',xp:150,t:"Servicio",d:"Atender pasajero"},{s:'int',xp:200,t:"Seguridad",d:"Chequeo"},{s:'str',xp:100,t:"Emergencia",d:"Protocolo"}] },
    eventplan: { es: "Event Planner", en: "Event Planner", m: [{s:'int',xp:200,t:"Log√≠stica",d:"Coordinar"},{s:'cha',xp:150,t:"Cliente",d:"Calmar nervios"},{s:'str',xp:150,t:"Montaje",d:"Supervisar"}] },

    // SALUD
    doctor: { es: "M√©dico", en: "Doctor", m: [{s:'int',xp:250,t:"Diagn√≥stico",d:"Analizar s√≠ntomas"},{s:'cha',xp:150,t:"Comunicar",d:"Dar noticias"},{s:'str',xp:200,t:"Guardia",d:"Turno largo"}] },
    nurse: { es: "Enfermero/a", en: "Nurse", m: [{s:'str',xp:150,t:"Ronda",d:"Signos vitales"},{s:'str',xp:150,t:"V√≠a",d:"Poner suero"},{s:'cha',xp:200,t:"Cuidado",d:"Apoyo emocional"}] },
    emt: { es: "Param√©dico", en: "EMT", m: [{s:'str',xp:250,t:"Rescate",d:"Actuar r√°pido"},{s:'str',xp:200,t:"Cargar",d:"Camilla"},{s:'int',xp:150,t:"Estabilizar",d:"Primeros auxilios"}] },
    dentist: { es: "Dentista", en: "Dentist", m: [{s:'str',xp:150,t:"Procedimiento",d:"Dientes"},{s:'int',xp:150,t:"Precisi√≥n",d:"Trabajo fino"},{s:'cha',xp:100,t:"Calmar",d:"Paciente nervioso"}] },
    vet: { es: "Veterinario", en: "Vet", m: [{s:'int',xp:200,t:"Diagn√≥stico",d:"Animal"},{s:'str',xp:150,t:"Cirug√≠a",d:"Operar"},{s:'cha',xp:100,t:"Due√±o",d:"Explicar"}] },
    pharm: { es: "Farmac√©utico", en: "Pharmacist", m: [{s:'int',xp:150,t:"Receta",d:"Verificar"},{s:'cha',xp:100,t:"Consejo",d:"Explicar uso"},{s:'int',xp:100,t:"Stock",d:"Control"}] },
    pt: { es: "Fisioterapeuta", en: "Physio", m: [{s:'str',xp:150,t:"Masaje",d:"Manual"},{s:'cha',xp:150,t:"Motivar",d:"Animar"},{s:'int',xp:100,t:"Plan",d:"Rutina"}] },
    trainer: { es: "Entrenador", en: "Trainer", m: [{s:'str',xp:150,t:"Clase",d:"Entreno 1:1"},{s:'cha',xp:150,t:"Corregir",d:"Postura"},{s:'int',xp:100,t:"Planificar",d:"Rutina mes"}] },

    // TRANSPORTE
    trucker: { es: "Camionero", en: "Trucker", m: [{s:'str',xp:200,t:"Conducir",d:"Ruta larga"},{s:'int',xp:100,t:"Logbook",d:"Registro"},{s:'str',xp:100,t:"Revisi√≥n",d:"Llantas/Frenos"}] },
    delivery: { es: "Repartidor", en: "Delivery", m: [{s:'str',xp:150,t:"Entregas",d:"R√°pido"},{s:'str',xp:100,t:"Carga",d:"Paquetes"},{s:'cha',xp:50,t:"Cliente",d:"Amabilidad"}] },
    pilot: { es: "Piloto", en: "Pilot", m: [{s:'int',xp:250,t:"Vuelo",d:"Seguro"},{s:'int',xp:150,t:"Checklist",d:"Pre-vuelo"},{s:'cha',xp:100,t:"Comunicaci√≥n",d:"Hablar con torre/pasajeros"}] },
    police: { es: "Polic√≠a", en: "Police", m: [{s:'str',xp:150,t:"Patrulla",d:"Vigilancia"},{s:'int',xp:150,t:"Informe",d:"Incidente"},{s:'cha',xp:200,t:"Calmar",d:"Desescalar"}] },
    fire: { es: "Bombero", en: "Firefighter", m: [{s:'str',xp:300,t:"Incendio",d:"Apagar/Rescatar"},{s:'str',xp:150,t:"Entreno",d:"F√≠sico"},{s:'int',xp:100,t:"Equipo",d:"Limpiar"}] },
    security: { es: "Seguridad", en: "Security", m: [{s:'str',xp:100,t:"Ronda",d:"Caminar"},{s:'int',xp:100,t:"C√°maras",d:"Observar"},{s:'cha',xp:100,t:"Acceso",d:"Verificar ID"}] },
    military: { es: "Militar", en: "Military", m: [{s:'str',xp:200,t:"PT / F√≠sico",d:"Entrenamiento duro"},{s:'int',xp:150,t:"Mantenimiento",d:"Limpiar arma/equipo"},{s:'str',xp:150,t:"Maniobras",d:"Ejercicio de campo"}] },

    // CORPORATIVO
    lawyer: { es: "Abogado", en: "Lawyer", m: [{s:'int',xp:200,t:"Redactar",d:"Documento legal"},{s:'int',xp:150,t:"Investigar",d:"Leyes"},{s:'cha',xp:200,t:"Negociar",d:"Acuerdo"}] },
    accountant: { es: "Contador", en: "Accountant", m: [{s:'int',xp:200,t:"Cierre",d:"Bancos"},{s:'int',xp:150,t:"Impuestos",d:"Declaraci√≥n"},{s:'int',xp:100,t:"Auditor√≠a",d:"Revisar"}] },
    hr: { es: "RRHH", en: "HR", m: [{s:'cha',xp:150,t:"Entrevista",d:"Candidato"},{s:'int',xp:100,t:"Admin",d:"Contratos"},{s:'cha',xp:200,t:"Conflicto",d:"Mediar"}] },
    pm: { es: "Project Mgr", en: "Project Mgr", m: [{s:'cha',xp:150,t:"Reuni√≥n",d:"Equipo"},{s:'int',xp:200,t:"Plan",d:"Cronograma"},{s:'cha',xp:100,t:"Reporte",d:"Jefes"}] },
    adminasst: { es: "Asistente", en: "Assistant", m: [{s:'int',xp:100,t:"Email",d:"Limpiar inbox"},{s:'cha',xp:150,t:"Agenda",d:"Coordinar"},{s:'int',xp:100,t:"Archivo",d:"Organizar"}] },
    realestate: { es: "Real Estate", en: "Real Estate", m: [{s:'str',xp:150,t:"Mostrar",d:"Propiedad"},{s:'cha',xp:100,t:"Llamadas",d:"Leads"},{s:'cha',xp:500,t:"Cierre",d:"Venta"}] },
    sales_ret: { es: "Vendedor", en: "Sales", m: [{s:'cha',xp:150,t:"Atender",d:"Cliente"},{s:'str',xp:100,t:"Reponer",d:"Stock"},{s:'int',xp:100,t:"Caja",d:"Cobrar"}] },
    consultant: { es: "Consultor", en: "Consultant", m: [{s:'int',xp:200,t:"Analizar",d:"Datos"},{s:'cha',xp:200,t:"Presentar",d:"Soluci√≥n"},{s:'int',xp:150,t:"Slides",d:"PowerPoint"}] },

    // TECH / CREATIVO
    dev: { es: "Programador", en: "Developer", m: [{s:'str',xp:100,t:"C√≥digo",d:"1h foco"},{s:'int',xp:150,t:"Debug",d:"Arreglar"},{s:'str',xp:300,t:"Deploy",d:"Publicar"}] },
    designer: { es: "Dise√±ador", en: "Designer", m: [{s:'int',xp:150,t:"Dise√±ar",d:"Crear"},{s:'cha',xp:100,t:"Feedback",d:"Cliente"},{s:'int',xp:100,t:"Exportar",d:"Archivos"}] },
    photo: { es: "Fot√≥grafo", en: "Photographer", m: [{s:'str',xp:200,t:"Fotos",d:"Sesi√≥n"},{s:'int',xp:150,t:"Editar",d:"Lightroom"},{s:'cha',xp:100,t:"Dirigir",d:"Modelo"}] },
    video: { es: "Vide√≥grafo", en: "Videographer", m: [{s:'str',xp:200,t:"Grabar",d:"Rodaje"},{s:'int',xp:200,t:"Editar",d:"Corte/Color"},{s:'int',xp:100,t:"Render",d:"Exportar"}] },
    architect: { es: "Arquitecto", en: "Architect", m: [{s:'int',xp:200,t:"Plano",d:"Dibujar"},{s:'str',xp:150,t:"Visita",d:"Obra"},{s:'cha',xp:100,t:"Cliente",d:"Presentar"}] },
    musician: { es: "M√∫sico", en: "Musician", m: [{s:'str',xp:150,t:"Ensayo",d:"Practicar"},{s:'cha',xp:200,t:"Show",d:"En vivo"},{s:'int',xp:150,t:"Componer",d:"Escribir"}] },
    tattoo: { es: "Tatuador", en: "Tattooist", m: [{s:'str',xp:250,t:"Tatuar",d:"Sesi√≥n"},{s:'int',xp:100,t:"Dise√±o",d:"Dibujo"},{s:'int',xp:100,t:"Higiene",d:"Limpiar"}] },

    // ESTUDIANTES
    stu_hs: { es: "Est. Secundaria", en: "HS Student", m: [{s:'str',xp:100,t:"Tarea",d:"A tiempo"},{s:'int',xp:200,t:"Examen",d:"Aprobar"},{s:'str',xp:150,t:"Deporte",d:"Clase"}] },
    stu_med: { es: "Est. Medicina", en: "Med Student", m: [{s:'int',xp:150,t:"Estudiar",d:"Flashcards"},{s:'str',xp:200,t:"Pr√°ctica",d:"Hospital"},{s:'int',xp:250,t:"Parcial",d:"Examen"}] },
    stu_law: { es: "Est. Derecho", en: "Law Student", m: [{s:'int',xp:200,t:"Leer",d:"Casos"},{s:'cha',xp:150,t:"Debate",d:"Clase"},{s:'int',xp:100,t:"Memorizar",d:"Leyes"}] },
    stu_eng: { es: "Est. Ingenier√≠a", en: "Eng Student", m: [{s:'int',xp:150,t:"Ejercicios",d:"Problemas"},{s:'str',xp:200,t:"Proyecto",d:"Construir"},{s:'int',xp:200,t:"C√°lculo",d:"Mate"}] },
    stu_arts: { es: "Est. Artes", en: "Arts Student", m: [{s:'str',xp:200,t:"Ensayo",d:"Escribir"},{s:'int',xp:150,t:"Lectura",d:"Libros"},{s:'cha',xp:100,t:"Clase",d:"Participar"}] },
    stu_biz: { es: "Est. Negocios", en: "Biz Student", m: [{s:'cha',xp:150,t:"Presentar",d:"Exponer"},{s:'int',xp:150,t:"Caso",d:"Analizar"},{s:'cha',xp:100,t:"Evento",d:"Networking"}] },
    stu_sci: { es: "Est. Ciencias", en: "Sci Student", m: [{s:'str',xp:200,t:"Lab",d:"Experimento"},{s:'int',xp:150,t:"Reporte",d:"Escribir"},{s:'int',xp:150,t:"Teor√≠a",d:"Estudiar"}] }
};

const GROUPS = {
    // WORK
    "üõ†Ô∏è OFICIOS": ["mechanic","electric","plumber","welder","carpenter","hvac","mason","painter","landscaper","pw","pest","locksmith","roofer","solar"],
    "ü§ù SERVICIO": ["chef","bartender","barista","server","frontdesk","flightatt","eventplan"],
    "üè• SALUD": ["doctor","nurse","emt","dentist","vet","pharm","pt","trainer"],
    "üöö TRANSPORTE": ["trucker","delivery","pilot","police","fire","security","military"],
    "üíº CORPORATIVO": ["lawyer","accountant","hr","pm","adminasst","realestate","sales_ret","consultant"],
    "üé® CREATIVO": ["dev","designer","photo","video","architect","musician","tattoo"],
    // STUDY
    "üéì ESTUDIANTES": ["stu_hs","stu_med","stu_law","stu_eng","stu_arts","stu_biz","stu_sci"]
};

const T = {
    es: { t_create:"CREA TU PERFIL", l_name:"Nombre", l_clan:"Clan", l_job:"Profesi√≥n", b_start:"EMPEZAR", l_lvl:"Nivel", s_str:"FUERZA", s_cha:"CARISMA", s_int:"MENTE", b_reset:"Reiniciar", t_danger:"ZONA DE PELIGRO", d_reset:"Nombre para borrar:", b_del:"BORRAR", b_sync:"GUARDAR NUBE", clans:["ü¶Å Leones","ü¶ä Zorros","üîÆ Magos","üêç Serpientes","üêê Cabras"] },
    en: { t_create:"CREATE PROFILE", l_name:"Name", l_clan:"Clan", l_job:"Profession", b_start:"START", l_lvl:"Level", s_str:"STRENGTH", s_cha:"CHARISMA", s_int:"MIND", b_reset:"Reset", t_danger:"DANGER ZONE", d_reset:"Name to delete:", b_del:"DELETE", b_sync:"SAVE CLOUD", clans:["ü¶Å Lions","ü¶ä Foxes","üîÆ Mages","üêç Serpents","üêê Goats"] }
};

let lang='es', mode='work', player={name:"",clan:"",jobKey:"",lvl:1,xp:0,next:1000,stats:{str:0,cha:0,int:0}};

window.onload = () => {
    try {
        lang = localStorage.getItem('rpg_lang') || 'es';
        setLang(lang, false);
        const clanSel = document.getElementById('inp-clan');
        clanSel.innerHTML = "";
        T[lang].clans.forEach((c, i) => { let o = document.createElement('option'); o.value = i; o.innerText = c; clanSel.appendChild(o); });

        // INICIAR EN MODO TRABAJO PARA QUE LA LISTA NO EST√â VAC√çA
        setMode('work');

        const save = localStorage.getItem('rpg_save_connected');
        if(save) {
            player = JSON.parse(save);
            if(!player.stats) player.stats={str:0,cha:0,int:0};
            initGame();
        } else {
            document.getElementById('screen-create').classList.add('active');
        }
    } catch(e) { document.getElementById('error-msg').style.display='block'; }
};

function setMode(m) {
    mode = m;
    document.getElementById('t-work').className = m === 'work' ? 'mode-btn active' : 'mode-btn';
    document.getElementById('t-study').className = m === 'study' ? 'mode-btn active' : 'mode-btn';

    const jobSel = document.getElementById('inp-job');
    jobSel.innerHTML = "";
    
    // FILTRADO ROBUSTO
    for (const [gName, keys] of Object.entries(GROUPS)) {
        const isStu = gName === "üéì ESTUDIANTES";
        // Si modo estudio: Solo mostrar Estudiantes
        // Si modo trabajo: Mostrar todo MENOS Estudiantes
        if ((m === 'study' && isStu) || (m === 'work' && !isStu)) {
            const grp = document.createElement('optgroup');
            grp.label = gName;
            keys.forEach(k => {
                if(JOBS_DB[k]) {
                    const opt = document.createElement('option');
                    opt.value = k;
                    opt.innerText = JOBS_DB[k][lang];
                    grp.appendChild(opt);
                }
            });
            jobSel.appendChild(grp);
        }
    }
}

function setLang(l, r=true) {
    lang = l; localStorage.setItem('rpg_lang', l);
    document.getElementById('btn-es').classList.toggle('active', l==='es');
    document.getElementById('btn-en').classList.toggle('active', l==='en');
    document.querySelectorAll('[data-t]').forEach(e => { if(T[l][e.dataset.t]) e.innerText = T[l][e.dataset.t]; });
    if(r) location.reload();
}

function startGame() {
    const n = document.getElementById('inp-name').value;
    if(!n) return alert("Name required");
    player.name = n;
    player.clan = T[lang].clans[document.getElementById('inp-clan').value];
    player.jobKey = document.getElementById('inp-job').value;
    save(); initGame();
}

function initGame() {
    document.getElementById('screen-create').classList.remove('active');
    document.getElementById('screen-game').classList.add('active');
    renderUI();
}

function renderUI() {
    document.getElementById('ui-name').innerText = player.name;
    const jd = JOBS_DB[player.jobKey];
    document.getElementById('ui-job').innerText = jd ? jd[lang] : "Job";
    document.getElementById('ui-clan').innerText = player.clan.split(' ')[0]+" "+player.clan.split(' ')[1];
    document.getElementById('ui-lvl').innerText = player.lvl;
    document.getElementById('v-str').innerText = player.stats.str;
    document.getElementById('v-cha').innerText = player.stats.cha;
    document.getElementById('v-int').innerText = player.stats.int;
    
    const pct = (player.xp / player.next)*100;
    document.getElementById('ui-xp').style.width = pct+"%";
    document.getElementById('ui-xp-txt').innerText = Math.floor(player.xp)+"/"+player.next;
    document.getElementById('reset-hint').innerText = player.name;
    renderMissions();
}

function renderMissions() {
    const area = document.getElementById('missions-area');
    area.innerHTML = "";
    const ms = JOBS_DB[player.jobKey] ? JOBS_DB[player.jobKey].m : [];

    ['str', 'cha', 'int'].forEach(stat => {
        const sub = ms.filter(m => m.s === stat);
        if(sub.length > 0) {
            const grp = document.createElement('div'); grp.className='m-group';
            const h = document.createElement('div'); h.className='m-head'; h.innerText=T[lang]['s_'+stat]; grp.appendChild(h);
            sub.forEach(m => {
                const b = document.createElement('div'); b.className='m-btn'; b.onclick=()=>gain(m.xp, m.s);
                const ti = m.t_es ? (lang==='es'?m.t_es:m.t_en) : m.t;
                const de = m.d_es ? (lang==='es'?m.d_es:m.d_en) : m.d;
                b.innerHTML = `<div class="m-info"><span class="m-title">${ti}</span><span class="m-desc">${de}</span></div><div class="xp-badge">+${m.xp}</div>`;
                grp.appendChild(b);
            });
            area.appendChild(grp);
        }
    });
}

function gain(xp, s) {
    player.xp+=xp; player.stats[s]++;
    if(player.xp >= player.next) { player.lvl++; player.xp-=player.next; player.next=Math.floor(player.next*1.2); toast("üéâ LEVEL UP!"); }
    else toast(`+${xp} XP`);
    save(); renderUI();
}

// FUNCI√ìN DE SINCRONIZACI√ìN CORREGIDA
function syncData() {
    const d = {
        name: player.name,
        level: player.lvl,
        job: JOBS_DB[player.jobKey] ? JOBS_DB[player.jobKey][lang] : "Unknown",
        stats: `S:${player.stats.str} C:${player.stats.cha} I:${player.stats.int}`
    };

    fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(d)
    })
    .then(r => {
        if(r.ok) toast("‚úÖ Saved to Cloud!");
        else toast("‚ùå Error Saving");
    })
    .catch(() => toast("‚ùå Connection Error"));
}

function toast(m) { const t=document.getElementById('toast'); t.innerText=m; t.style.opacity=1; t.style.bottom="40px"; setTimeout(()=>{t.style.opacity=0;t.style.bottom="30px"},2000); }
function save() { localStorage.setItem('rpg_save_connected', JSON.stringify(player)); }
function openReset() { document.getElementById('modal-reset').style.display='flex'; }
function closeReset() { document.getElementById('modal-reset').style.display='none'; }
function confirmReset() { if(document.getElementById('inp-reset').value===player.name){localStorage.removeItem('rpg_save_connected');location.reload();} }
</script>
</body>
</html>
